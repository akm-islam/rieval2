{"ast":null,"code":"import _toConsumableArray from\"/Users/kaustav/NewWork/trivea/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _classCallCheck from\"/Users/kaustav/NewWork/trivea/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/kaustav/NewWork/trivea/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"/Users/kaustav/NewWork/trivea/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _createSuper from\"/Users/kaustav/NewWork/trivea/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import _inherits from\"/Users/kaustav/NewWork/trivea/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import React,{Component}from'react';import*as d3 from'd3';import{connect}from\"react-redux\";import*as algo1 from\"../../../Algorithms/algo1\";import*as $ from'jquery';import CreatexpCircle from\"../ExpChart/Create_exp_circles\";import\"../ExpChart/MDS.css\";var SlopeChart=/*#__PURE__*/function(_Component){_inherits(SlopeChart,_Component);var _super=_createSuper(SlopeChart);function SlopeChart(props){var _this;_classCallCheck(this,SlopeChart);_this=_super.call(this,props);_this.Createsvg=function(model_name,exp_id,state_range){var self=_assertThisInitialized(_this);var selected_instances=d3.range(state_range[0],state_range[1]+1);if(_this.props.histogram_data.length>0){selected_instances=_this.props.histogram_data;}//-------------------- Threshold filter\nvar under_threshold_instances=[];var year_data=_this.props.original_data.filter(function(item){return _this.props.selected_year==item['1-qid'];});_this.props.default_models.map(function(model_name){year_data.map(function(item){var two_realRank=parseInt(item['two_realRank']);var predicted_rank=parseInt(item[model_name]);if(Math.abs(predicted_rank-two_realRank)>_this.props.threshold){under_threshold_instances.push(two_realRank);}});});selected_instances=selected_instances.filter(function(item){return!under_threshold_instances.includes(item);});//console.log(selected_instances,\"selected_instances2\")\n//--------------------\n//------------------------------\nvar number_of_charts=8+self.state.excluded_features.length;var indexed_features=algo1.getSortedFeatures(_this.props.lime_data[model_name],selected_instances,_this.props.selected_year);var temp_sorted_features=indexed_features.filter(function(item){return!_this.state.excluded_features.includes(item);});// Exclude crossed features \nvar sorted_features=temp_sorted_features.slice(0,number_of_charts).map(function(item,index){return[item,index];});var marginTop=5,marginBottom=10;var parent_height=parseInt($('.explanation_chart_parent').height())-_this.state.mds_height-parseInt($('.title_p').height());var item_width=parseInt($(\"#\"+_this.props.exp_id).width());var item_height=(parent_height-10)/sorted_features.length-marginTop;// 10 is the top margin\nvar feature_containers=d3.select('#'+_this.props.exp_id).attr('height',parent_height).selectAll(\".feature_items\").data(sorted_features,function(d){return d[0];}).join(function(enter){return enter.append(\"svg\").attr(\"y\",function(d,i){return marginTop+i*(item_height+marginTop);});},function(update){return update.transition().duration(2000).attr(\"y\",function(d,i){return marginTop+i*(item_height+marginTop);});},function(exit){return exit.remove();});feature_containers.attr(\"class\",function(d){return\"feature_items \"+d[0];}).attr(\"myindex\",function(d,i){return i;}).attr('feature_name',function(d){return d[0];});feature_containers.attr(\"add_title_text_and_rect_for_title_text\",function(d,index){d3.select(this).selectAll(\".title_rect\").data([0]).join('rect').attr(\"class\",\"title_rect\").attr(\"myindex\",index).attr('feature_name',d[0]).attr(\"width\",\"100%\").attr(\"height\",18).attr(\"fill\",\"#e2e2e2\").attr(\"y\",0).attr(\"x\",0);d3.select(this).selectAll(\".title_text\").data([0]).join('text').attr(\"class\",\"title_text\").attr(\"myindex\",index).attr('feature_name',d[0]).attr('x',item_width/2).text(d[0]).attr(\"dominant-baseline\",\"hanging\").attr(\"y\",2).attr('text-anchor','middle').attr('font-size',12);});feature_containers.attr(\"add_cross_button\",function(d,index){d3.select(this).selectAll(\".cross_button\").data([0]).join(\"text\").attr('y',7.3).attr('dominant-baseline','middle').attr(\"myindex\",index).attr('feature_name',d[0]).raise().attr('x',item_width-15).style('cursor','pointer').attr('font-size',14).attr('fill','black').text(\"\\uF410\").attr('class',\"cross_button fa make_cursor\").on('click',function(){d3.event.preventDefault();self.setState({excluded_features:[].concat(_toConsumableArray(self.state.excluded_features),[d[0]])});});//---\nd3.select(this).selectAll(\".expand_button\").data([0]).join(\"text\").attr('y',7.3).attr('dominant-baseline','middle').attr(\"myindex\",index).attr('feature_name',d[0]).raise().attr('x',item_width-35).style('cursor','pointer').attr('font-size',12).attr('fill','black').text(\"\\uF31E\").attr('class',\"expand_button fa make_cursor\").on('click',function(){var feature=d[0];var year=self.props.selected_year;d3.event.preventDefault();var temp=_toConsumableArray(self.props.dbclicked_features);if(!temp.includes(feature)){temp.unshift(feature);d3.selectAll(\".rect\").classed(\"exp_chart_clicked\",true);}self.props.set_dbclicked_features(temp);//----------------------------Data for popup chart\nvar popup_chart_data={};self.props.default_models.filter(function(item){return item!=\"ListNet\";}).map(function(model_name){var data=[];if(self.props.histogram_data.length>0){data=self.props.lime_data[model_name].filter(function(element){if(parseInt(element['1-qid'])==parseInt(year)&&self.props.histogram_data.includes(parseInt(element['two_realRank']))){return element;}});}else{data=self.props.lime_data[model_name].filter(function(element){return parseInt(element['1-qid'])==parseInt(year)&&selected_instances.includes(parseInt(element['two_realRank']));});}popup_chart_data[model_name]=data;});self.props.Set_popup_chart_data([popup_chart_data,feature]);// This is to update the pop when the year or anything changes during the pop up is open\n//self.props.Set_popup_chart_data([popup_chart_data, feature])\nself.props.set_pop_over(true);});//---\n});feature_containers.attr(\"add_rect_for_circle_background_and_handle_clicks\",function(d,index){d3.select(this).selectAll(\".circ_rect\").data([0]).join('rect').attr(\"class\",\"circ_rect\").attr(\"myindex\",index).attr('feature_name',d[0]).attr(\"width\",\"100%\").attr(\"height\",item_height-18).attr(\"fill\",\"#f2f2f2\").attr(\"y\",18).attr(\"x\",0).on('click',function(){if(self.props.clicked_features.includes(d[0])){self.props.Set_clicked_features(self.props.clicked_features.filter(function(item){return item!=d[0];}));d3.selectAll(\".\"+d[0]).selectAll(\".border_rect\").remove();}else{self.props.Set_clicked_features([].concat(_toConsumableArray(self.props.clicked_features),[d[0]]));d3.selectAll(\".\"+d[0]).selectAll(\".border_rect\").data([0]).join('rect').attr(\"class\",\"border_rect\").attr(\"width\",\"100%\").attr(\"height\",\"100%\").style(\"stroke\",\"black\").style(\"fill\",\"none\").style(\"stroke-width\",5);}});});feature_containers.attr(\"CreatexpCircle\",function(d,index){var title_rect_height=16;CreatexpCircle(d,d3.select(this),selected_instances,self.props.lime_data,self.props.selected_year,[model_name],self.props.clicked_circles,self.props.Set_clicked_circles,self.props.diverginColor,self.props.anim_config,item_width,item_height-(marginTop+marginBottom),self.props.deviation_array,index,self.props.threshold,self.props.dataset,title_rect_height,'label_on',sorted_features);}).attr(\"height\",function(d){if(d[1]==sorted_features.length-1){var ft_svg_height=25;var svg=d3.select(this.parentNode).selectAll(\".ft_svg\").data([0]).join(\"svg\").attr(\"x\",0).attr(\"y\",parent_height-ft_svg_height).attr(\"class\",\"ft_svg\").attr(\"width\",item_width).attr(\"height\",ft_svg_height);var markerBoxWidth=8,markerBoxHeight=8,refX=markerBoxWidth/2,refY=markerBoxHeight/2;svg.append('defs').append('marker').attr('id','arrow').attr('viewBox',[0,0,markerBoxWidth,markerBoxHeight]).attr('refX',refX).attr('refY',refY).attr('markerWidth',markerBoxWidth).attr('markerHeight',markerBoxHeight).attr('orient','auto-start-reverse').append('path').attr('d',d3.line()([[0,0],[0,7],[7,3.8]])).attr('stroke','#777777').attr(\"fill\",\"#777777\");//------------------------------------------------[[x2, y2], [x1, y1]]\nsvg.append('path').attr('d',d3.line()([[item_width/2-65,15],[50,15]])).attr('stroke','#777777').attr('marker-end','url(#arrow)').attr('fill','none');svg.append('path').attr('d',d3.line()([[item_width-50,15],[65+item_width/2,15]])).attr('stroke','#777777').attr('marker-start','url(#arrow)').attr('fill','none');svg.selectAll(\".myText_low\").data([0]).join(\"text\").attr(\"x\",30).attr(\"class\",\"myText_low\").attr('dominant-baseline',\"middle\").attr(\"y\",15).text('Low').attr('text-anchor','middle').attr(\"font-size\",12).attr(\"fill\",\"#2b2828\");svg.selectAll(\".myText\").data([0]).join(\"text\").attr(\"x\",item_width/2).attr(\"class\",\"myText\").attr('dominant-baseline',\"middle\").attr(\"y\",15).text('attribute Importance').attr('text-anchor','middle').attr(\"font-size\",12).attr(\"fill\",\"#2b2828\");svg.selectAll(\".myText_high\").data([0]).join(\"text\").attr(\"x\",item_width-30).attr(\"class\",\"myText_high\").attr('dominant-baseline',\"middle\").attr(\"y\",15).text('High').attr('text-anchor','middle').attr(\"font-size\",12).attr(\"fill\",\"#2b2828\");return item_height-marginBottom-marginTop;}return item_height-marginBottom-marginTop;}).attr('width',item_width);feature_containers.attr('check_clicked_features',function(d){if(self.props.clicked_features.includes(d[0])){d3.selectAll(\".\"+d[0]).selectAll(\".border_rect\").data([0]).join('rect').attr(\"class\",\"border_rect\").attr(\"width\",\"100%\").attr(\"height\",\"100%\").style(\"stroke\",\"black\").style(\"fill\",\"none\").style(\"stroke-width\",5);}});};_this.line_color=null;_this.exp=React.createRef();_this.mds=React.createRef();_this.state={mds_height:10,mouseX:0,mouseY:0,excluded_features:[],sorted_features:null,circle_data:null,indexed_features:null,random:true};return _this;}_createClass(SlopeChart,[{key:\"componentDidMount\",value:function componentDidMount(){this.setState({width:window.innerHeight});}},{key:\"componentDidUpdate\",value:function componentDidUpdate(prevProps,prevState){this.Createsvg(this.props.model_name,this.props.exp_id,this.props.state_range);}},{key:\"render\",//------------------------------\nvalue:function render(){return/*#__PURE__*/React.createElement(\"div\",{className:\"explanation_chart_parent exp\"+this.props.model_name,style:{width:'100%',height:'100%',\"border\":this.props.mode=='Model'?\"2px solid #e2e2e2\":'none',padding:\"2px 5px\"}},/*#__PURE__*/React.createElement(\"p\",{className:\"title_p\",style:{padding:0,margin:0}},this.props.model_name),/*#__PURE__*/React.createElement(\"svg\",{id:this.props.exp_id,style:{marginTop:this.state.mds_height,width:\"100%\"}}),/*#__PURE__*/React.createElement(\"marker\",{id:\"arrow\",markerUnits:\"strokeWidth\",markerWidth:\"12\",markerHeight:\"12\",viewBox:\"0 0 12 12\",refX:\"6\",refY:\"6\",orient:\"auto\"},/*#__PURE__*/React.createElement(\"path\",{d:\"M2,2 L10,6 L2,10 L6,6 L2,2\",style:{fill:\"black\"}})));}}]);return SlopeChart;}(Component);var maptstateToprop=function maptstateToprop(state){return{deviation_array:state.deviation_array,original_data:state.original_data,time_mode_model:state.time_mode_model,dataset:state.dataset,histogram_data:state.histogram_data,sparkline_data:state.sparkline_data,anim_config:state.anim_config,show:state.show,average_m:state.average_m,average_y:state.average_y,lime_data:state.lime_data,rank_data:state.rank_data,clicked_circles:state.clicked_circles,clicked_features:state.clicked_features,threshold:state.threshold,mode:state.mode,dbclicked_features:state.dbclicked_features,dragged_features:state.dragged_features,url:state.url};};var mapdispatchToprop=function mapdispatchToprop(dispatch){return{Set_dragged_features:function Set_dragged_features(val){return dispatch({type:\"dragged_features\",value:val});},Set_clicked_circles:function Set_clicked_circles(val){return dispatch({type:\"clicked_circles\",value:val});},Set_prev_prop:function Set_prev_prop(val){return dispatch({type:\"prev_prop\",value:val});},Set_sparkline_data:function Set_sparkline_data(val){return dispatch({type:\"sparkline_data\",value:val});},Set_replay:function Set_replay(val){return dispatch({type:\"replay\",value:val});},Set_clicked_features:function Set_clicked_features(val){return dispatch({type:\"clicked_features\",value:val});},Set_selected_year:function Set_selected_year(val){return dispatch({type:\"selected_year\",value:val});},set_dbclicked_features:function set_dbclicked_features(val){return dispatch({type:\"dbclicked_features\",value:val});},Set_popup_chart_data:function Set_popup_chart_data(val){return dispatch({type:\"popup_chart_data\",value:val});},set_pop_over:function set_pop_over(val){return dispatch({type:\"pop_over\",value:val});}};};export default connect(maptstateToprop,mapdispatchToprop)(SlopeChart);","map":{"version":3,"sources":["/Users/kaustav/NewWork/trivea/src/components/Charts/Range/02RangeExpChart.js"],"names":["React","Component","d3","connect","algo1","$","CreatexpCircle","SlopeChart","props","Createsvg","model_name","exp_id","state_range","self","selected_instances","range","histogram_data","length","under_threshold_instances","year_data","original_data","filter","item","selected_year","default_models","map","two_realRank","parseInt","predicted_rank","Math","abs","threshold","push","includes","number_of_charts","state","excluded_features","indexed_features","getSortedFeatures","lime_data","temp_sorted_features","sorted_features","slice","index","marginTop","marginBottom","parent_height","height","mds_height","item_width","width","item_height","feature_containers","select","attr","selectAll","data","d","join","enter","append","i","update","transition","duration","exit","remove","text","raise","style","on","event","preventDefault","setState","feature","year","temp","dbclicked_features","unshift","classed","set_dbclicked_features","popup_chart_data","element","Set_popup_chart_data","set_pop_over","clicked_features","Set_clicked_features","title_rect_height","clicked_circles","Set_clicked_circles","diverginColor","anim_config","deviation_array","dataset","ft_svg_height","svg","parentNode","markerBoxWidth","markerBoxHeight","refX","refY","line","line_color","exp","createRef","mds","mouseX","mouseY","circle_data","random","window","innerHeight","prevProps","prevState","mode","padding","margin","fill","maptstateToprop","time_mode_model","sparkline_data","show","average_m","average_y","rank_data","dragged_features","url","mapdispatchToprop","dispatch","Set_dragged_features","val","type","value","Set_prev_prop","Set_sparkline_data","Set_replay","Set_selected_year"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport * as d3 from 'd3';\nimport { connect } from \"react-redux\";\nimport * as algo1 from \"../../../Algorithms/algo1\";\nimport * as $ from 'jquery';\nimport CreatexpCircle from \"../ExpChart/Create_exp_circles\"\nimport \"../ExpChart/MDS.css\"\nclass SlopeChart extends Component {\n  constructor(props) {\n    super(props);\n    this.line_color = null;\n    this.exp = React.createRef()\n    this.mds = React.createRef()\n    this.state = { mds_height: 10, mouseX: 0, mouseY: 0, excluded_features: [], sorted_features: null, circle_data: null, indexed_features: null, random: true }\n  }\n  componentDidMount() {\n    this.setState({ width: window.innerHeight })\n  }\n  componentDidUpdate(prevProps, prevState) {\n    this.Createsvg(this.props.model_name, this.props.exp_id, this.props.state_range)\n  }\n  Createsvg = (model_name, exp_id, state_range) => {\n    var self = this\n    var selected_instances = d3.range(state_range[0], state_range[1] + 1)\n    if (this.props.histogram_data.length > 0) { selected_instances = this.props.histogram_data }\n    //-------------------- Threshold filter\n    var under_threshold_instances = []\n    var year_data = this.props.original_data.filter(item => this.props.selected_year == item['1-qid'])\n    this.props.default_models.map(model_name => {\n      year_data.map(item => {\n        var two_realRank = parseInt(item['two_realRank'])\n        var predicted_rank = parseInt(item[model_name])\n        if (Math.abs(predicted_rank - two_realRank) > this.props.threshold) {\n          under_threshold_instances.push(two_realRank)\n        }\n      })\n    })\n    selected_instances = selected_instances.filter(item => !under_threshold_instances.includes(item))\n    //console.log(selected_instances,\"selected_instances2\")\n    //--------------------\n\n    //------------------------------\n    var number_of_charts = 8 + self.state.excluded_features.length\n    \n    var indexed_features = algo1.getSortedFeatures(this.props.lime_data[model_name],selected_instances, this.props.selected_year)\n    var temp_sorted_features = indexed_features.filter(item => !this.state.excluded_features.includes(item))// Exclude crossed features \n    var sorted_features = temp_sorted_features.slice(0, number_of_charts).map((item, index) => [item, index])\n\n    var marginTop = 5,marginBottom = 10\n    var parent_height = parseInt($('.explanation_chart_parent').height()) - this.state.mds_height - parseInt($('.title_p').height())\n    var item_width = parseInt($(\"#\" + this.props.exp_id).width())\n    var item_height = (parent_height - 10) / sorted_features.length - marginTop // 10 is the top margin\n    var feature_containers = d3.select('#' + this.props.exp_id).attr('height', parent_height).selectAll(\".feature_items\").data(sorted_features, d => d[0])\n      .join(enter => enter.append(\"svg\").attr(\"y\", (d, i) => marginTop + i * (item_height + marginTop))\n        , update => update.transition().duration(2000).attr(\"y\", (d, i) => marginTop + i * (item_height + marginTop))\n        , exit => exit.remove()\n      )\n    feature_containers.attr(\"class\", d => \"feature_items \" + d[0]).attr(\"myindex\", (d, i) => i).attr('feature_name', d => d[0])\n\n    feature_containers.attr(\"add_title_text_and_rect_for_title_text\", function (d, index) {\n      d3.select(this).selectAll(\".title_rect\").data([0]).join('rect').attr(\"class\", \"title_rect\").attr(\"myindex\", index).attr('feature_name', d[0]).attr(\"width\", \"100%\").attr(\"height\", 18).attr(\"fill\", \"#e2e2e2\").attr(\"y\", 0).attr(\"x\", 0)\n      d3.select(this).selectAll(\".title_text\").data([0]).join('text').attr(\"class\", \"title_text\").attr(\"myindex\", index).attr('feature_name', d[0]).attr('x', item_width / 2).text(d[0]).attr(\"dominant-baseline\", \"hanging\")\n        .attr(\"y\", 2).attr('text-anchor', 'middle').attr('font-size', 12)\n    })\n    feature_containers.attr(\"add_cross_button\", function (d, index) {\n      d3.select(this).selectAll(\".cross_button\").data([0]).join(\"text\").attr('y', 7.3).attr('dominant-baseline', 'middle').attr(\"myindex\", index).attr('feature_name', d[0]).raise()\n        .attr('x', item_width - 15).style('cursor', 'pointer').attr('font-size', 14).attr('fill', 'black')\n        .text(\"\\uf410\").attr('class', \"cross_button fa make_cursor\").on('click', () => {\n          d3.event.preventDefault()\n          self.setState({ excluded_features: [...self.state.excluded_features, d[0]] })\n        })\n        //---\n        d3.select(this).selectAll(\".expand_button\").data([0]).join(\"text\").attr('y', 7.3)\n        .attr('dominant-baseline', 'middle').attr(\"myindex\", index).attr('feature_name', d[0]).raise()\n        .attr('x', item_width - 35).style('cursor', 'pointer').attr('font-size', 12).attr('fill', 'black')\n        .text(\"\\uf31e\").attr('class', \"expand_button fa make_cursor\").on('click', () => {\n          var feature = d[0]\n          var year = self.props.selected_year\n          d3.event.preventDefault()\n          var temp = [...self.props.dbclicked_features]\n          if (!temp.includes(feature)) {\n            temp.unshift(feature)\n            d3.selectAll(\".rect\").classed(\"exp_chart_clicked\", true)\n          }\n          self.props.set_dbclicked_features(temp)\n          //----------------------------Data for popup chart\n          var popup_chart_data = {}\n          self.props.default_models.filter(item => item != \"ListNet\").map(model_name => {\n            var data = []\n            if (self.props.histogram_data.length > 0) {\n              data = self.props.lime_data[model_name].filter(element => { if ((parseInt(element['1-qid']) == parseInt(year)) && (self.props.histogram_data.includes(parseInt(element['two_realRank'])))) { return element } });\n            }\n            else {\n              data = self.props.lime_data[model_name].filter(element => parseInt(element['1-qid']) == parseInt(year) && selected_instances.includes(parseInt(element['two_realRank'])))\n            }\n            popup_chart_data[model_name] = data\n          })\n          self.props.Set_popup_chart_data([popup_chart_data, feature]) // This is to update the pop when the year or anything changes during the pop up is open\n          //self.props.Set_popup_chart_data([popup_chart_data, feature])\n          self.props.set_pop_over(true)\n        })\n        //---\n    })\n    feature_containers.attr(\"add_rect_for_circle_background_and_handle_clicks\", function (d, index) {\n      d3.select(this).selectAll(\".circ_rect\").data([0]).join('rect').attr(\"class\", \"circ_rect\").attr(\"myindex\", index).attr('feature_name', d[0]).attr(\"width\", \"100%\").attr(\"height\", item_height - 18).attr(\"fill\", \"#f2f2f2\").attr(\"y\", 18).attr(\"x\", 0)\n        .on('click', () => {\n          if (self.props.clicked_features.includes(d[0])) {\n            self.props.Set_clicked_features(self.props.clicked_features.filter(item => item != d[0]))\n            d3.selectAll(\".\" + d[0]).selectAll(\".border_rect\").remove()\n          }\n          else {\n            self.props.Set_clicked_features([...self.props.clicked_features, d[0]])\n            d3.selectAll(\".\" + d[0]).selectAll(\".border_rect\").data([0]).join('rect').attr(\"class\", \"border_rect\").attr(\"width\", \"100%\").attr(\"height\", \"100%\").style(\"stroke\", \"black\").style(\"fill\", \"none\").style(\"stroke-width\", 5)\n          }\n        })\n        \n\n    })\n    feature_containers.attr(\"CreatexpCircle\", function (d, index) {\n      var title_rect_height=16\n      CreatexpCircle(d, d3.select(this), selected_instances, self.props.lime_data, self.props.selected_year, [model_name], self.props.clicked_circles,\n        self.props.Set_clicked_circles, self.props.diverginColor, self.props.anim_config, item_width, item_height-(marginTop+marginBottom), self.props.deviation_array, index, self.props.threshold,self.props.dataset,title_rect_height,'label_on',sorted_features)\n    }).attr(\"height\", function (d) {\n        if (d[1] == sorted_features.length - 1) {\n          var ft_svg_height = 25\n          \n          var svg = d3.select(this.parentNode).selectAll(\".ft_svg\").data([0]).join(\"svg\").attr(\"x\", 0).attr(\"y\", parent_height - ft_svg_height).attr(\"class\", \"ft_svg\").attr(\"width\", item_width).attr(\"height\", ft_svg_height)\n          var markerBoxWidth = 8, markerBoxHeight = 8, refX = markerBoxWidth / 2, refY = markerBoxHeight / 2\n          svg.append('defs').append('marker').attr('id', 'arrow').attr('viewBox', [0, 0, markerBoxWidth, markerBoxHeight])\n            .attr('refX', refX).attr('refY', refY).attr('markerWidth', markerBoxWidth).attr('markerHeight', markerBoxHeight).attr('orient', 'auto-start-reverse')\n            .append('path').attr('d', d3.line()([[0, 0], [0, 7], [7, 3.8]])).attr('stroke', '#777777').attr(\"fill\",\"#777777\");\n          //------------------------------------------------[[x2, y2], [x1, y1]]\n          svg.append('path').attr('d', d3.line()([[item_width / 2 - 65, 15], [50, 15]])).attr('stroke', '#777777').attr('marker-end', 'url(#arrow)').attr('fill', 'none');\n          svg.append('path').attr('d', d3.line()([[item_width - 50, 15], [65 + item_width / 2, 15]])).attr('stroke', '#777777').attr('marker-start', 'url(#arrow)').attr('fill', 'none');\n\n          svg.selectAll(\".myText_low\").data([0]).join(\"text\").attr(\"x\", 30).attr(\"class\", \"myText_low\").attr('dominant-baseline', \"middle\").attr(\"y\", 15).text('Low').attr('text-anchor', 'middle').attr(\"font-size\", 12).attr(\"fill\", \"#2b2828\")\n          svg.selectAll(\".myText\").data([0]).join(\"text\").attr(\"x\", item_width / 2).attr(\"class\", \"myText\").attr('dominant-baseline', \"middle\").attr(\"y\", 15).text('attribute Importance').attr('text-anchor', 'middle').attr(\"font-size\", 12).attr(\"fill\", \"#2b2828\")\n          svg.selectAll(\".myText_high\").data([0]).join(\"text\").attr(\"x\", item_width-30).attr(\"class\", \"myText_high\").attr('dominant-baseline', \"middle\").attr(\"y\", 15).text('High').attr('text-anchor', 'middle').attr(\"font-size\", 12).attr(\"fill\", \"#2b2828\")\n          return item_height - marginBottom - marginTop\n        }\n        return item_height - marginBottom - marginTop\n      }).attr('width', item_width)\n    feature_containers.attr('check_clicked_features', d => {\n      if (self.props.clicked_features.includes(d[0])) {\n        d3.selectAll(\".\" + d[0]).selectAll(\".border_rect\").data([0]).join('rect').attr(\"class\", \"border_rect\").attr(\"width\", \"100%\").attr(\"height\", \"100%\").style(\"stroke\", \"black\").style(\"fill\", \"none\").style(\"stroke-width\", 5)\n      }\n    })\n  }\n  //------------------------------\n  render() {\n    return (\n      <div className={\"explanation_chart_parent exp\" + this.props.model_name} style={{ width: '100%', height: '100%', \"border\": this.props.mode == 'Model' ? \"2px solid #e2e2e2\" : 'none', padding: \"2px 5px\" }}>\n        <p className=\"title_p\" style={{ padding: 0, margin: 0 }}>{this.props.model_name}</p>\n        <svg id={this.props.exp_id} style={{ marginTop: this.state.mds_height, width: \"100%\" }}></svg>\n        <marker id=\"arrow\" markerUnits=\"strokeWidth\" markerWidth=\"12\" markerHeight=\"12\" viewBox=\"0 0 12 12\" refX=\"6\" refY=\"6\" orient=\"auto\">\n          <path d=\"M2,2 L10,6 L2,10 L6,6 L2,2\" style={{ fill: \"black\" }}></path>\n        </marker>\n      </div>\n    )\n  }\n}\nconst maptstateToprop = (state) => {\n  return {\n    deviation_array: state.deviation_array,\n    original_data: state.original_data,\n    time_mode_model: state.time_mode_model,\n    dataset: state.dataset,\n    histogram_data: state.histogram_data,\n    sparkline_data: state.sparkline_data,\n    anim_config: state.anim_config,\n    show: state.show,\n    average_m: state.average_m,\n    average_y: state.average_y,\n    lime_data: state.lime_data,\n    rank_data: state.rank_data,\n    clicked_circles: state.clicked_circles,\n    clicked_features: state.clicked_features,\n    threshold: state.threshold,\n    mode: state.mode,\n    dbclicked_features: state.dbclicked_features,\n    dragged_features: state.dragged_features,\n    url: state.url,\n  }\n}\nconst mapdispatchToprop = (dispatch) => {\n  return {\n    Set_dragged_features: (val) => dispatch({ type: \"dragged_features\", value: val }),\n    Set_clicked_circles: (val) => dispatch({ type: \"clicked_circles\", value: val }),\n    Set_prev_prop: (val) => dispatch({ type: \"prev_prop\", value: val }),\n    Set_sparkline_data: (val) => dispatch({ type: \"sparkline_data\", value: val }),\n    Set_replay: (val) => dispatch({ type: \"replay\", value: val }),\n    Set_clicked_features: (val) => dispatch({ type: \"clicked_features\", value: val }),\n    Set_selected_year: (val) => dispatch({ type: \"selected_year\", value: val }),\n    set_dbclicked_features: (val) => dispatch({ type: \"dbclicked_features\", value: val }),\n    Set_popup_chart_data: (val) => dispatch({ type: \"popup_chart_data\", value: val }),\n    set_pop_over: (val) => dispatch({ type: \"pop_over\", value: val }),\n  }\n}\nexport default connect(maptstateToprop, mapdispatchToprop)(SlopeChart);"]},"metadata":{},"sourceType":"module"}