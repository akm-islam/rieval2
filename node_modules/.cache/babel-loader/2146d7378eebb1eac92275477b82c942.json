{"ast":null,"code":"import*as d3 from\"d3\";import*as $ from\"jquery\";export default function CreateHistogram(histogram_data,svg,feature_name,feature_index,number_of_features,store_instances){var margin={top:10,right:5,bottom:50,left:5};var parent_width=$(\".feature_histograms_container\").width();var feature_height=120;var feature_width=parent_width;d3.select(\".feature_histograms_container\").attr('height',feature_height*number_of_features+20);svg.attr('y',feature_height*feature_index).attr('width',parent_width).attr('height',feature_height);var item_data=histogram_data.map(function(item){return item['y'];});var area_chart_height=feature_height-margin.top-margin.bottom;var area_chart_width=feature_width-margin.left-margin.right;var y=d3.scaleLinear().domain(d3.extent(item_data)).range([margin.top,area_chart_height]);var myticks=y.ticks(25);var binned_data=d3.histogram().value(function(d){return d;}).domain(y.domain()).thresholds(myticks)(item_data);//--------- Create the areaChart\nvar area_chart_data=[];binned_data.map(function(item,i){return area_chart_data.push([item.x1,item.length]);});console.log(feature_name,histogram_data);var xScale=d3.scaleLinear().domain(d3.extent(area_chart_data.map(function(item){return item[0];}))).range([margin.left,feature_width-margin.right]);// 20 is the baseline\nvar yScale=d3.scaleLinear().domain([0,d3.max(area_chart_data.map(function(item){return item[1];}))]).range([area_chart_height,0]);var areaGenerator=d3.area().curve(d3.curveMonotoneX).x(function(d){return xScale(d[0]);}).y0(yScale(0)).y1(function(d){return yScale(d[1]);});svg.append(\"path\").attr('transform','translate(0,'+margin.top+')').attr(\"d\",areaGenerator(area_chart_data)).style(\"fill\",\"gray\");//--------------------------------\nsvg.selectAll(\".xAxis_g\").data([0]).join('g').attr('class','xAxis_g').attr(\"transform\",\"translate(0,\"+(feature_height-margin.bottom)+\")\").call(d3.axisBottom(xScale).ticks(5).tickFormat(d3.format(\".2s\")));//.call(d3.axisBottom(xScale).ticks(5));\nsvg.selectAll('.domain').attr('stroke','#dddddd');svg.call(d3.brushX().extent([[0,margin.top],[400,area_chart_height+margin.top]]).on(\"end\",function(){var extent=d3.event.selection;if(extent!=null){var lower=xScale.invert(extent[0]),upper=xScale.invert(extent[1]);var instances=histogram_data.filter(function(item){return item['y']>=lower&&item['y']<=upper;}).map(function(item){return item['x'];});// x contains the ranking and y contains the value\nstore_instances(feature_name,instances);}else{store_instances(feature_name,[]);}}));svg.selectAll(\".title\").data([0]).join('text').attr(\"class\",\"title\").attr('x',feature_width/2).attr('y',feature_height-28).attr('dominant-baseline','hanging').attr('text-anchor','middle').text(feature_name).attr('font-size',14).style('text-transform','capitalize').attr(\"fill\",\"#3d3b3b\");}//https://stackoverflow.com/questions/54236051/how-to-draw-a-vertical-area-chart","map":{"version":3,"sources":["/Users/kaustav/NewWork/trivea/src/components/Top/FeatureHistograms/CreateHistogram.js"],"names":["d3","$","CreateHistogram","histogram_data","svg","feature_name","feature_index","number_of_features","store_instances","margin","top","right","bottom","left","parent_width","width","feature_height","feature_width","select","attr","item_data","map","item","area_chart_height","area_chart_width","y","scaleLinear","domain","extent","range","myticks","ticks","binned_data","histogram","value","d","thresholds","area_chart_data","i","push","x1","length","console","log","xScale","yScale","max","areaGenerator","area","curve","curveMonotoneX","x","y0","y1","append","style","selectAll","data","join","call","axisBottom","tickFormat","format","brushX","on","event","selection","lower","invert","upper","instances","filter","text"],"mappings":"AAAA,MAAO,GAAKA,CAAAA,EAAZ,KAAoB,IAApB,CACA,MAAO,GAAKC,CAAAA,CAAZ,KAAmB,QAAnB,CACA,cAAe,SAASC,CAAAA,eAAT,CAAyBC,cAAzB,CAAyCC,GAAzC,CAA8CC,YAA9C,CAA4DC,aAA5D,CAA2EC,kBAA3E,CAA+FC,eAA/F,CAAgH,CAC7H,GAAMC,CAAAA,MAAM,CAAG,CAAEC,GAAG,CAAE,EAAP,CAAWC,KAAK,CAAE,CAAlB,CAAqBC,MAAM,CAAE,EAA7B,CAAiCC,IAAI,CAAE,CAAvC,CAAf,CACA,GAAIC,CAAAA,YAAY,CAAGb,CAAC,CAAC,+BAAD,CAAD,CAAmCc,KAAnC,EAAnB,CACA,GAAIC,CAAAA,cAAc,CAAG,GAArB,CACA,GAAIC,CAAAA,aAAa,CAAGH,YAApB,CACAd,EAAE,CAACkB,MAAH,CAAU,+BAAV,EAA2CC,IAA3C,CAAgD,QAAhD,CAA0DH,cAAc,CAAGT,kBAAjB,CAAsC,EAAhG,EACAH,GAAG,CAACe,IAAJ,CAAS,GAAT,CAAcH,cAAc,CAAGV,aAA/B,EAA8Ca,IAA9C,CAAmD,OAAnD,CAA4DL,YAA5D,EAA0EK,IAA1E,CAA+E,QAA/E,CAAyFH,cAAzF,EACA,GAAII,CAAAA,SAAS,CAAGjB,cAAc,CAACkB,GAAf,CAAmB,SAAAC,IAAI,QAAIA,CAAAA,IAAI,CAAC,GAAD,CAAR,EAAvB,CAAhB,CACA,GAAIC,CAAAA,iBAAiB,CAAGP,cAAc,CAAGP,MAAM,CAACC,GAAxB,CAA8BD,MAAM,CAACG,MAA7D,CACA,GAAIY,CAAAA,gBAAgB,CAAGP,aAAa,CAAGR,MAAM,CAACI,IAAvB,CAA8BJ,MAAM,CAACE,KAA5D,CACA,GAAMc,CAAAA,CAAC,CAAGzB,EAAE,CAAC0B,WAAH,GAAiBC,MAAjB,CAAwB3B,EAAE,CAAC4B,MAAH,CAAUR,SAAV,CAAxB,EAA8CS,KAA9C,CAAoD,CAACpB,MAAM,CAACC,GAAR,CAAaa,iBAAb,CAApD,CAAV,CAEA,GAAIO,CAAAA,OAAO,CAAGL,CAAC,CAACM,KAAF,CAAQ,EAAR,CAAd,CACA,GAAIC,CAAAA,WAAW,CAAGhC,EAAE,CAACiC,SAAH,GAAeC,KAAf,CAAqB,SAAAC,CAAC,QAAIA,CAAAA,CAAJ,EAAtB,EAA6BR,MAA7B,CAAoCF,CAAC,CAACE,MAAF,EAApC,EAAgDS,UAAhD,CAA2DN,OAA3D,EAAoEV,SAApE,CAAlB,CACA;AACA,GAAIiB,CAAAA,eAAe,CAAG,EAAtB,CACAL,WAAW,CAACX,GAAZ,CAAgB,SAACC,IAAD,CAAOgB,CAAP,QAAaD,CAAAA,eAAe,CAACE,IAAhB,CAAqB,CAACjB,IAAI,CAACkB,EAAN,CAAUlB,IAAI,CAACmB,MAAf,CAArB,CAAb,EAAhB,EACAC,OAAO,CAACC,GAAR,CAAYtC,YAAZ,CAAyBF,cAAzB,EACA,GAAIyC,CAAAA,MAAM,CAAG5C,EAAE,CAAC0B,WAAH,GAAiBC,MAAjB,CAAwB3B,EAAE,CAAC4B,MAAH,CAAUS,eAAe,CAAChB,GAAhB,CAAoB,SAAAC,IAAI,QAAIA,CAAAA,IAAI,CAAC,CAAD,CAAR,EAAxB,CAAV,CAAxB,EAAyEO,KAAzE,CAA+E,CAACpB,MAAM,CAACI,IAAR,CAAcI,aAAa,CAAGR,MAAM,CAACE,KAArC,CAA/E,CAAb,CAAyI;AACzI,GAAIkC,CAAAA,MAAM,CAAG7C,EAAE,CAAC0B,WAAH,GAAiBC,MAAjB,CAAwB,CAAC,CAAD,CAAI3B,EAAE,CAAC8C,GAAH,CAAOT,eAAe,CAAChB,GAAhB,CAAoB,SAAAC,IAAI,QAAIA,CAAAA,IAAI,CAAC,CAAD,CAAR,EAAxB,CAAP,CAAJ,CAAxB,EAA2EO,KAA3E,CAAiF,CAACN,iBAAD,CAAoB,CAApB,CAAjF,CAAb,CACA,GAAMwB,CAAAA,aAAa,CAAG/C,EAAE,CAACgD,IAAH,GAAUC,KAAV,CAAgBjD,EAAE,CAACkD,cAAnB,EAAmCC,CAAnC,CAAqC,SAAAhB,CAAC,QAAIS,CAAAA,MAAM,CAACT,CAAC,CAAC,CAAD,CAAF,CAAV,EAAtC,EAAwDiB,EAAxD,CAA2DP,MAAM,CAAC,CAAD,CAAjE,EAAsEQ,EAAtE,CAAyE,SAAAlB,CAAC,QAAIU,CAAAA,MAAM,CAACV,CAAC,CAAC,CAAD,CAAF,CAAV,EAA1E,CAAtB,CAEA/B,GAAG,CAACkD,MAAJ,CAAW,MAAX,EAAmBnC,IAAnB,CAAwB,WAAxB,CAAqC,eAAiBV,MAAM,CAACC,GAAxB,CAA8B,GAAnE,EACGS,IADH,CACQ,GADR,CACa4B,aAAa,CAACV,eAAD,CAD1B,EAEGkB,KAFH,CAES,MAFT,CAEiB,MAFjB,EAGF;AACEnD,GAAG,CAACoD,SAAJ,CAAc,UAAd,EAA0BC,IAA1B,CAA+B,CAAC,CAAD,CAA/B,EAAoCC,IAApC,CAAyC,GAAzC,EAA8CvC,IAA9C,CAAmD,OAAnD,CAA4D,SAA5D,EAAuEA,IAAvE,CAA4E,WAA5E,CAAyF,gBAAkBH,cAAc,CAAGP,MAAM,CAACG,MAA1C,EAAoD,GAA7I,EACG+C,IADH,CACQ3D,EAAE,CAAC4D,UAAH,CAAchB,MAAd,EAAsBb,KAAtB,CAA4B,CAA5B,EAA+B8B,UAA/B,CAA0C7D,EAAE,CAAC8D,MAAH,CAAU,KAAV,CAA1C,CADR,EAEA;AACA1D,GAAG,CAACoD,SAAJ,CAAc,SAAd,EAAyBrC,IAAzB,CAA8B,QAA9B,CAAwC,SAAxC,EACAf,GAAG,CAACuD,IAAJ,CAAS3D,EAAE,CAAC+D,MAAH,GAAYnC,MAAZ,CAAmB,CAAC,CAAC,CAAD,CAAInB,MAAM,CAACC,GAAX,CAAD,CAAkB,CAAC,GAAD,CAAMa,iBAAiB,CAAGd,MAAM,CAACC,GAAjC,CAAlB,CAAnB,EAA6EsD,EAA7E,CAAgF,KAAhF,CAAuF,UAAM,CACpG,GAAIpC,CAAAA,MAAM,CAAG5B,EAAE,CAACiE,KAAH,CAASC,SAAtB,CACA,GAAItC,MAAM,EAAI,IAAd,CAAoB,CAClB,GAAIuC,CAAAA,KAAK,CAAGvB,MAAM,CAACwB,MAAP,CAAcxC,MAAM,CAAC,CAAD,CAApB,CAAZ,CAAsCyC,KAAK,CAAGzB,MAAM,CAACwB,MAAP,CAAcxC,MAAM,CAAC,CAAD,CAApB,CAA9C,CACA,GAAI0C,CAAAA,SAAS,CAAGnE,cAAc,CAACoE,MAAf,CAAsB,SAAAjD,IAAI,QAAIA,CAAAA,IAAI,CAAC,GAAD,CAAJ,EAAa6C,KAAb,EAAsB7C,IAAI,CAAC,GAAD,CAAJ,EAAa+C,KAAvC,EAA1B,EAAwEhD,GAAxE,CAA4E,SAAAC,IAAI,QAAIA,CAAAA,IAAI,CAAC,GAAD,CAAR,EAAhF,CAAhB,CAA+G;AAC/Gd,eAAe,CAACH,YAAD,CAAeiE,SAAf,CAAf,CACD,CAJD,IAKI,CAAC9D,eAAe,CAACH,YAAD,CAAe,EAAf,CAAf,CAAkC,CACxC,CARQ,CAAT,EASAD,GAAG,CAACoD,SAAJ,CAAc,QAAd,EAAwBC,IAAxB,CAA6B,CAAC,CAAD,CAA7B,EAAkCC,IAAlC,CAAuC,MAAvC,EAA+CvC,IAA/C,CAAoD,OAApD,CAA4D,OAA5D,EAAqEA,IAArE,CAA0E,GAA1E,CAA+EF,aAAa,CAAG,CAA/F,EAAkGE,IAAlG,CAAuG,GAAvG,CAA4GH,cAAc,CAAG,EAA7H,EAAiIG,IAAjI,CAAsI,mBAAtI,CAA2J,SAA3J,EACCA,IADD,CACM,aADN,CACqB,QADrB,EAC+BqD,IAD/B,CACoCnE,YADpC,EACkDc,IADlD,CACuD,WADvD,CACoE,EADpE,EACwEoC,KADxE,CAC8E,gBAD9E,CACgG,YADhG,EAECpC,IAFD,CAEM,MAFN,CAEa,SAFb,EAGD,CACD","sourcesContent":["import * as d3 from \"d3\"\nimport * as $ from \"jquery\"\nexport default function CreateHistogram(histogram_data, svg, feature_name, feature_index, number_of_features, store_instances) {\n  const margin = { top: 10, right: 5, bottom: 50, left: 5 };\n  var parent_width = $(\".feature_histograms_container\").width()\n  var feature_height = 120\n  var feature_width = parent_width\n  d3.select(\".feature_histograms_container\").attr('height', feature_height * number_of_features + 20)\n  svg.attr('y', feature_height * feature_index).attr('width', parent_width).attr('height', feature_height)\n  var item_data = histogram_data.map(item => item['y'])\n  var area_chart_height = feature_height - margin.top - margin.bottom;\n  var area_chart_width = feature_width - margin.left - margin.right\n  const y = d3.scaleLinear().domain(d3.extent(item_data)).range([margin.top, area_chart_height])\n\n  var myticks = y.ticks(25)\n  var binned_data = d3.histogram().value(d => d).domain(y.domain()).thresholds(myticks)(item_data)\n  //--------- Create the areaChart\n  var area_chart_data = []\n  binned_data.map((item, i) => area_chart_data.push([item.x1, item.length]))\n  console.log(feature_name,histogram_data)\n  var xScale = d3.scaleLinear().domain(d3.extent(area_chart_data.map(item => item[0]))).range([margin.left, feature_width - margin.right]) // 20 is the baseline\n  var yScale = d3.scaleLinear().domain([0, d3.max(area_chart_data.map(item => item[1]))]).range([area_chart_height, 0])\n  const areaGenerator = d3.area().curve(d3.curveMonotoneX).x(d => xScale(d[0])).y0(yScale(0)).y1(d => yScale(d[1]))\n\n  svg.append(\"path\").attr('transform', 'translate(0,' + margin.top + ')')\n    .attr(\"d\", areaGenerator(area_chart_data))\n    .style(\"fill\", \"gray\");\n//--------------------------------\n  svg.selectAll(\".xAxis_g\").data([0]).join('g').attr('class', 'xAxis_g').attr(\"transform\", \"translate(0,\" + (feature_height - margin.bottom) + \")\")\n    .call(d3.axisBottom(xScale).ticks(5).tickFormat(d3.format(\".2s\")));\n  //.call(d3.axisBottom(xScale).ticks(5));\n  svg.selectAll('.domain').attr('stroke', '#dddddd')\n  svg.call(d3.brushX().extent([[0, margin.top], [400, area_chart_height + margin.top]]).on(\"end\", () => {\n    var extent = d3.event.selection\n    if (extent != null) {\n      var lower = xScale.invert(extent[0]), upper = xScale.invert(extent[1])\n      var instances = histogram_data.filter(item => item['y'] >= lower && item['y'] <= upper).map(item => item['x']) // x contains the ranking and y contains the value\n      store_instances(feature_name, instances)\n    }\n    else{store_instances(feature_name, [])}\n  }))\n  svg.selectAll(\".title\").data([0]).join('text').attr(\"class\",\"title\").attr('x', feature_width / 2).attr('y', feature_height - 28).attr('dominant-baseline', 'hanging')\n  .attr('text-anchor', 'middle').text(feature_name).attr('font-size', 14).style('text-transform', 'capitalize')\n  .attr(\"fill\",\"#3d3b3b\")\n}\n//https://stackoverflow.com/questions/54236051/how-to-draw-a-vertical-area-chart"]},"metadata":{},"sourceType":"module"}