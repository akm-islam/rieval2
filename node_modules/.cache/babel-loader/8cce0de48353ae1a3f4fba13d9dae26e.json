{"ast":null,"code":"import _toConsumableArray from\"/Users/kaustav/NewWork/trivea/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _classCallCheck from\"/Users/kaustav/NewWork/trivea/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/kaustav/NewWork/trivea/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"/Users/kaustav/NewWork/trivea/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _createSuper from\"/Users/kaustav/NewWork/trivea/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import _inherits from\"/Users/kaustav/NewWork/trivea/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import React,{Component}from'react';import*as d3 from'd3';import{connect}from\"react-redux\";import*as algo1 from\"../../../Algorithms/algo1\";import*as $ from'jquery';import CreatexpCircle from\"../ExpChart/Create_exp_circles\";import\"../ExpChart/MDS.css\";import*as misc_algo from'../../../Algorithms/misc_algo';var SlopeChart=/*#__PURE__*/function(_Component){_inherits(SlopeChart,_Component);var _super=_createSuper(SlopeChart);function SlopeChart(props){var _this;_classCallCheck(this,SlopeChart);_this=_super.call(this,props);_this.Createsvg=function(model_name,indexed_features){var self=_assertThisInitialized(_this);var selected_instances=d3.range(_this.props.state_range[0],_this.props.state_range[1]+1);if(_this.props.histogram_data.length>0){selected_instances=_this.props.histogram_data;}//-------------------- Threshold filter\nvar under_threshold_instances=[];var year_data=_this.props.original_data.filter(function(item){return _this.props.selected_year==item['1-qid'];});_this.props.default_models.map(function(model_name){year_data.map(function(item){var two_realRank=parseInt(item['two_realRank']);var predicted_rank=parseInt(item[model_name]);if(Math.abs(predicted_rank-two_realRank)<_this.props.threshold){under_threshold_instances.push(two_realRank);}});});selected_instances=selected_instances.filter(function(item){return under_threshold_instances.includes(item);});var number_of_charts=8+self.state.excluded_features.length;var indexed_features=algo1.getSortedFeatures(_this.props.lime_data[model_name],selected_instances,_this.props.selected_year);var temp_sorted_features=indexed_features.filter(function(item){return!_this.state.excluded_features.includes(item);});// Exclude crossed features \nvar sorted_features=temp_sorted_features.slice(0,number_of_charts).map(function(item,index){return[item,index];});var marginTop=2,marginBottom=0,space_for_x_axis=25,title_rect_height=40;var parent_height=parseInt($('.explanation_chart_parent').height())-_this.state.mds_height-parseInt($('.title_p').height());var item_width=parseInt($(\"#\"+model_name).width());var item_height=(parent_height-space_for_x_axis)/sorted_features.length-(marginTop+marginBottom);// 10 is the top margin\nvar feature_containers=d3.select('#'+model_name).attr('height',parent_height).selectAll(\".feature_items\").data(sorted_features,function(d){return d[0];}).join(function(enter){return enter.append(\"svg\").attr(\"y\",function(d,i){return marginTop+i*(item_height+marginTop+marginBottom);});},function(update){return update.transition().duration(2000).attr(\"y\",function(d,i){return marginTop+i*(item_height+marginTop+marginBottom);});},function(exit){return exit.remove();});feature_containers.attr(\"class\",function(d){return\"feature_items \"+d[0];}).attr(\"myindex\",function(d,i){return i;}).attr('feature_name',function(d){return d[0];}).attr(\"height\",function(d){if(d[1]==sorted_features.length-1){var ft_svg_height=25;d3.select(this.parentNode).selectAll(\".ft_svg\").remove();var svg=d3.select(this.parentNode).selectAll(\".ft_svg\").data([Math.random()]).join(\"svg\").attr(\"x\",0).attr(\"y\",parent_height-ft_svg_height).attr(\"class\",\"ft_svg\").attr(\"width\",item_width).attr(\"height\",ft_svg_height);var markerBoxWidth=8,markerBoxHeight=8,refX=markerBoxWidth/2,refY=markerBoxHeight/2;svg.selectAll('defs').data([0]).join('defs').selectAll('#arrow').data([0]).join('marker').attr('id','arrow').attr('viewBox',[0,0,markerBoxWidth,markerBoxHeight]).attr('refX',refX).attr('refY',refY).attr('markerWidth',markerBoxWidth).attr('markerHeight',markerBoxHeight).attr('orient','auto-start-reverse').append('path').attr('id','path1').attr('d',d3.line()([[0,0],[0,7],[7,3.8]])).attr('stroke','#777777').attr(\"fill\",\"#777777\");//------------------------------------------------[[x2, y2], [x1, y1]]\nsvg.append('path').attr('d',d3.line()([[item_width/2-65,15],[50,15]])).attr('stroke','#777777').attr('marker-end','url(#arrow)').attr('fill','none');svg.append('path').attr('d',d3.line()([[item_width-50,15],[65+item_width/2,15]])).attr('stroke','#777777').attr('marker-start','url(#arrow)').attr('fill','none');svg.selectAll(\".myText_low\").data([0]).join(\"text\").attr(\"x\",30).attr(\"class\",\"myText_low\").attr('dominant-baseline',\"middle\").attr(\"y\",15).text('Low').attr('text-anchor','middle').attr(\"font-size\",12).attr(\"fill\",\"#2b2828\");svg.selectAll(\".myText\").data([0]).join(\"text\").attr(\"x\",item_width/2).attr(\"class\",\"myText\").attr('dominant-baseline',\"middle\").attr(\"y\",15).text('Attribute Importance').attr('text-anchor','middle').attr(\"font-size\",12).attr(\"fill\",\"#2b2828\");svg.selectAll(\".myText_high\").data([0]).join(\"text\").attr(\"x\",item_width-30).attr(\"class\",\"myText_high\").attr('dominant-baseline',\"middle\").attr(\"y\",15).text('High').attr('text-anchor','middle').attr(\"font-size\",12).attr(\"fill\",\"#2b2828\");return item_height-marginBottom-marginTop;}return item_height-marginBottom-marginTop;}).attr('width',item_width);feature_containers.attr(\"add_title_text_and_rect_for_title_text\",function(d,index){d3.select(this).selectAll(\".title_rect\").data([0]).join('rect').attr(\"class\",\"title_rect\").attr(\"myindex\",index).attr('feature_name',d[0]).attr(\"width\",\"100%\").attr(\"height\",title_rect_height).attr(\"fill\",\"#e2e2e2\").attr(\"y\",0).attr(\"x\",0);d3.select(this).selectAll(\".title_text\").data([0]).join('text').attr(\"class\",\"title_text\").attr(\"myindex\",index).attr('feature_name',d[0]).attr('x',item_width/2).text(d[0]).attr(\"dominant-baseline\",\"middle\").attr(\"y\",title_rect_height/2).attr('text-anchor','middle').attr('font-size',14);});feature_containers.attr(\"add_cross_button\",function(d,index){d3.select(this).selectAll(\".cross_button\").data([0]).join(\"text\").attr('y',title_rect_height/2).attr('dominant-baseline','middle').attr(\"myindex\",index).attr('feature_name',d[0]).raise().attr('x',item_width-15).style('cursor','pointer').attr('font-size',14).attr('fill','black').text(\"\\uF410\").attr('class',\"cross_button fa make_cursor\").on('click',function(){d3.event.preventDefault();self.setState({excluded_features:[].concat(_toConsumableArray(self.state.excluded_features),[d[0]])});});//---\nd3.select(this).selectAll(\".expand_button\").data([0]).join(\"text\").attr('y',title_rect_height/2).attr('dominant-baseline','middle').attr(\"myindex\",index).attr('feature_name',d[0]).raise().attr('x',item_width-35).style('cursor','pointer').attr('font-size',12).attr('fill','black').text(\"\\uF31E\").attr('class',\"expand_button fa make_cursor\").on('click',function(){self.props.Set_pop_over_models([self.props.model_name]);d3.event.preventDefault();var feature=d[0];var year=self.props.selected_year;d3.event.preventDefault();var temp=_toConsumableArray(self.props.dbclicked_features);if(!temp.includes(feature)){temp.unshift(feature);d3.selectAll(\".rect\").classed(\"exp_chart_clicked\",true);}self.props.set_dbclicked_features(temp);//self.props.set_dbclicked_features([feature])\n//----------------------------Data for popup chart\nvar popup_chart_data={};self.props.default_models.filter(function(item){return item!=\"ListNet\";}).map(function(model_name){var data=[];if(self.props.histogram_data.length>0){data=self.props.lime_data[model_name].filter(function(element){if(parseInt(element['1-qid'])==parseInt(year)&&self.props.histogram_data.includes(parseInt(element['two_realRank']))){return element;}});}else{data=self.props.lime_data[model_name].filter(function(element){return parseInt(element['1-qid'])==parseInt(year)&&selected_instances.includes(parseInt(element['two_realRank']));});}popup_chart_data[model_name]=data;});self.props.Set_popup_chart_data([popup_chart_data,feature]);// This is to update the pop when the year or anything changes during the pop up is open\n//self.props.Set_popup_chart_data([popup_chart_data, feature])\nself.props.set_pop_over(true);});//---\n});feature_containers.attr(\"add_rect_for_circle_background_and_handle_clicks\",function(d,index){d3.select(this).selectAll(\".circ_rect\").data([0]).join('rect').attr(\"class\",\"circ_rect\").attr(\"myindex\",index).attr('feature_name',d[0]).attr(\"width\",\"100%\").attr(\"height\",item_height-title_rect_height).attr(\"fill\",\"#ffffff\").attr(\"y\",title_rect_height).on('click',function(){if(self.props.clicked_features.includes(d[0])){self.props.Set_clicked_features(self.props.clicked_features.filter(function(item){return item!=d[0];}));d3.selectAll(\".\"+d[0]).selectAll(\".border_rect\").remove();}else{self.props.Set_clicked_features([].concat(_toConsumableArray(self.props.clicked_features),[d[0]]));d3.selectAll(\".\"+d[0]).selectAll(\".border_rect\").data([0]).join('rect').attr(\"class\",\"border_rect\").attr(\"width\",\"100%\").attr(\"height\",\"100%\").style(\"stroke\",\"black\").style(\"fill\",\"none\").style(\"stroke-width\",5);}});});feature_containers.attr(\"CreatexpCircle\",function(d,index){CreatexpCircle(d,d3.select(this),selected_instances,self.props.lime_data,self.props.selected_year,[model_name],self.props.clicked_circles,self.props.Set_clicked_circles,self.props.diverginColor,self.props.anim_config,item_width,item_height-(marginTop+marginBottom),self.props.deviation_array,index,self.props.threshold,self.props.dataset,title_rect_height,self.props.label_on,sorted_features);});feature_containers.attr('check_clicked_features',function(d){if(self.props.clicked_features.includes(d[0])){d3.selectAll(\".\"+d[0]).selectAll(\".border_rect\").data([0]).join('rect').attr(\"class\",\"border_rect\").attr(\"width\",\"100%\").attr(\"height\",\"100%\").style(\"stroke\",\"black\").style(\"fill\",\"none\").style(\"stroke-width\",5);}});};_this.line_color=null;_this.exp=React.createRef();_this.mds=React.createRef();_this.state={mds_height:10,mouseX:0,mouseY:0,excluded_features:[],sorted_features:null,circle_data:null,indexed_features:null,random:true};return _this;}_createClass(SlopeChart,[{key:\"componentDidMount\",value:function componentDidMount(){this.setState({width:window.innerHeight});}},{key:\"componentDidUpdate\",value:function componentDidUpdate(prev_props){this.Createsvg(this.props.model_name,null);if(this.props.clicked_circles.length!=0&&JSON.stringify(prev_props.clicked_circles)===JSON.stringify(this.props.clicked_circles)){misc_algo.handle_transparency(\"None\",this.props.clicked_circles,this.props.anim_config);}else{this.Createsvg(this.props.model_name,null);}}},{key:\"render\",//------------------------------\nvalue:function render(){return/*#__PURE__*/React.createElement(\"div\",{key:this.props.model_name,className:\"explanation_chart_parent exp\"+this.props.model_name,style:{width:'100%',height:'100%',\"border\":this.props.mode=='Model'?\"2px solid #e2e2e2\":'none',padding:\"2px 5px\"}},/*#__PURE__*/React.createElement(\"p\",{className:\"title_p\",style:{padding:0,margin:0}},this.props.model_name),/*#__PURE__*/React.createElement(\"svg\",{ref:this.exp,id:this.props.model_name,style:{marginTop:this.state.mds_height,width:\"100%\"}}),/*#__PURE__*/React.createElement(\"marker\",{id:\"arrow\",markerUnits:\"strokeWidth\",markerWidth:\"12\",markerHeight:\"12\",viewBox:\"0 0 12 12\",refX:\"6\",refY:\"6\",orient:\"auto\"},/*#__PURE__*/React.createElement(\"path\",{d:\"M2,2 L10,6 L2,10 L6,6 L2,2\",style:{fill:\"black\"}})));}}]);return SlopeChart;}(Component);var maptstateToprop=function maptstateToprop(state){return{deviation_array:state.deviation_array,original_data:state.original_data,time_mode_model:state.time_mode_model,chart_scale_type:state.chart_scale_type,dataset:state.dataset,histogram_data:state.histogram_data,sparkline_data:state.sparkline_data,anim_config:state.anim_config,show:state.show,average_m:state.average_m,average_y:state.average_y,lime_data:state.lime_data,rank_data:state.rank_data,clicked_circles:state.clicked_circles,clicked_features:state.clicked_features,threshold:state.threshold,mode:state.mode,dbclicked_features:state.dbclicked_features,dragged_features:state.dragged_features,url:state.url,default_models:state.default_models,label_on:state.label_on};};var mapdispatchToprop=function mapdispatchToprop(dispatch){return{Set_dragged_features:function Set_dragged_features(val){return dispatch({type:\"dragged_features\",value:val});},Set_clicked_circles:function Set_clicked_circles(val){return dispatch({type:\"clicked_circles\",value:val});},Set_prev_prop:function Set_prev_prop(val){return dispatch({type:\"prev_prop\",value:val});},Set_sparkline_data:function Set_sparkline_data(val){return dispatch({type:\"sparkline_data\",value:val});},Set_replay:function Set_replay(val){return dispatch({type:\"replay\",value:val});},Set_clicked_features:function Set_clicked_features(val){return dispatch({type:\"clicked_features\",value:val});},Set_selected_year:function Set_selected_year(val){return dispatch({type:\"selected_year\",value:val});},set_dbclicked_features:function set_dbclicked_features(val){return dispatch({type:\"dbclicked_features\",value:val});},Set_popup_chart_data:function Set_popup_chart_data(val){return dispatch({type:\"popup_chart_data\",value:val});},set_pop_over:function set_pop_over(val){return dispatch({type:\"pop_over\",value:val});},Set_pop_over_models:function Set_pop_over_models(val){return dispatch({type:\"pop_over_models\",value:val});}};};export default connect(maptstateToprop,mapdispatchToprop)(SlopeChart);","map":{"version":3,"sources":["/Users/kaustav/NewWork/trivea/src/components/Charts/Model/ExpChartComponent.js"],"names":["React","Component","d3","connect","algo1","$","CreatexpCircle","misc_algo","SlopeChart","props","Createsvg","model_name","indexed_features","self","selected_instances","range","state_range","histogram_data","length","under_threshold_instances","year_data","original_data","filter","item","selected_year","default_models","map","two_realRank","parseInt","predicted_rank","Math","abs","threshold","push","includes","number_of_charts","state","excluded_features","getSortedFeatures","lime_data","temp_sorted_features","sorted_features","slice","index","marginTop","marginBottom","space_for_x_axis","title_rect_height","parent_height","height","mds_height","item_width","width","item_height","feature_containers","select","attr","selectAll","data","d","join","enter","append","i","update","transition","duration","exit","remove","ft_svg_height","parentNode","svg","random","markerBoxWidth","markerBoxHeight","refX","refY","line","text","raise","style","on","event","preventDefault","setState","Set_pop_over_models","feature","year","temp","dbclicked_features","unshift","classed","set_dbclicked_features","popup_chart_data","element","Set_popup_chart_data","set_pop_over","clicked_features","Set_clicked_features","clicked_circles","Set_clicked_circles","diverginColor","anim_config","deviation_array","dataset","label_on","line_color","exp","createRef","mds","mouseX","mouseY","circle_data","window","innerHeight","prev_props","JSON","stringify","handle_transparency","mode","padding","margin","fill","maptstateToprop","time_mode_model","chart_scale_type","sparkline_data","show","average_m","average_y","rank_data","dragged_features","url","mapdispatchToprop","dispatch","Set_dragged_features","val","type","value","Set_prev_prop","Set_sparkline_data","Set_replay","Set_selected_year"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport * as d3 from 'd3';\nimport { connect } from \"react-redux\";\nimport * as algo1 from \"../../../Algorithms/algo1\";\nimport * as $ from 'jquery';\nimport CreatexpCircle from \"../ExpChart/Create_exp_circles\"\nimport \"../ExpChart/MDS.css\"\nimport * as misc_algo from '../../../Algorithms/misc_algo'\nclass SlopeChart extends Component {\n  constructor(props) {\n    super(props);\n    this.line_color = null;\n    this.exp = React.createRef()\n    this.mds = React.createRef()\n    this.state = { mds_height: 10, mouseX: 0, mouseY: 0, excluded_features: [], sorted_features: null, circle_data: null, indexed_features: null, random: true }\n  }\n  componentDidMount() {\n    this.setState({ width: window.innerHeight })\n  }\n  componentDidUpdate(prev_props) {\n    this.Createsvg(this.props.model_name, null)\n    if (this.props.clicked_circles.length != 0 && JSON.stringify(prev_props.clicked_circles) === JSON.stringify(this.props.clicked_circles)) {\n      misc_algo.handle_transparency(\"None\", this.props.clicked_circles, this.props.anim_config)\n    }\n    else {\n      this.Createsvg(this.props.model_name, null)\n    }\n  }\n  Createsvg = (model_name, indexed_features) => {\n    var self = this\n    var selected_instances = d3.range(this.props.state_range[0], this.props.state_range[1] + 1)\n    if (this.props.histogram_data.length > 0) { selected_instances = this.props.histogram_data }\n\n    //-------------------- Threshold filter\n    var under_threshold_instances = []\n    var year_data = this.props.original_data.filter(item => this.props.selected_year == item['1-qid'])\n    this.props.default_models.map(model_name => {\n      year_data.map(item => {\n        var two_realRank = parseInt(item['two_realRank'])\n        var predicted_rank = parseInt(item[model_name])\n        if (Math.abs(predicted_rank - two_realRank) < this.props.threshold) {\n          under_threshold_instances.push(two_realRank)\n        }\n      })\n    })\n    selected_instances = selected_instances.filter(item => under_threshold_instances.includes(item))\n    var number_of_charts = 8 + self.state.excluded_features.length\n    \n    var indexed_features = algo1.getSortedFeatures(this.props.lime_data[model_name],selected_instances, this.props.selected_year)\n    var temp_sorted_features = indexed_features.filter(item => !this.state.excluded_features.includes(item))// Exclude crossed features \n    var sorted_features = temp_sorted_features.slice(0, number_of_charts).map((item, index) => [item, index])\n\n\n\n\n\n\n    var marginTop = 2,marginBottom = 0, space_for_x_axis = 25,title_rect_height=40\n    var parent_height = parseInt($('.explanation_chart_parent').height()) - this.state.mds_height - parseInt($('.title_p').height())\n    var item_width = parseInt($(\"#\" + model_name).width())\n    var item_height = (parent_height - space_for_x_axis) / sorted_features.length - (marginTop + marginBottom) // 10 is the top margin\n\n    var feature_containers = d3.select('#' + model_name).attr('height', parent_height)\n      .selectAll(\".feature_items\").data(sorted_features, d => d[0])\n      .join(enter => enter.append(\"svg\").attr(\"y\", (d, i) => marginTop + i * (item_height + marginTop + marginBottom))\n        , update => update.transition().duration(2000).attr(\"y\", (d, i) => marginTop + i * (item_height + marginTop + marginBottom))\n        , exit => exit.remove()\n      )\n    feature_containers.attr(\"class\", d => \"feature_items \" + d[0]).attr(\"myindex\", (d, i) => i).attr('feature_name', d => d[0])\n      .attr(\"height\", function (d) {\n        if (d[1] == sorted_features.length - 1) {\n          var ft_svg_height = 25\n          d3.select(this.parentNode).selectAll(\".ft_svg\").remove()\n          var svg = d3.select(this.parentNode).selectAll(\".ft_svg\").data([Math.random()]).join(\"svg\").attr(\"x\", 0).attr(\"y\", parent_height - ft_svg_height).attr(\"class\", \"ft_svg\").attr(\"width\", item_width).attr(\"height\", ft_svg_height)\n          var markerBoxWidth = 8, markerBoxHeight = 8, refX = markerBoxWidth / 2, refY = markerBoxHeight / 2\n          \n          svg.selectAll('defs').data([0]).join('defs').selectAll('#arrow').data([0]).join('marker').attr('id', 'arrow').attr('viewBox', [0, 0, markerBoxWidth, markerBoxHeight])\n            .attr('refX', refX).attr('refY', refY).attr('markerWidth', markerBoxWidth).attr('markerHeight', markerBoxHeight).attr('orient', 'auto-start-reverse')\n            .append('path').attr('id','path1').attr('d', d3.line()([[0, 0], [0, 7], [7, 3.8]])).attr('stroke', '#777777').attr(\"fill\",\"#777777\");\n          //------------------------------------------------[[x2, y2], [x1, y1]]\n          svg.append('path').attr('d', d3.line()([[item_width / 2 - 65, 15], [50, 15]])).attr('stroke', '#777777').attr('marker-end', 'url(#arrow)').attr('fill', 'none');\n          svg.append('path').attr('d', d3.line()([[item_width - 50, 15], [65 + item_width / 2, 15]])).attr('stroke', '#777777').attr('marker-start', 'url(#arrow)').attr('fill', 'none');\n\n          svg.selectAll(\".myText_low\").data([0]).join(\"text\").attr(\"x\", 30).attr(\"class\", \"myText_low\").attr('dominant-baseline', \"middle\").attr(\"y\", 15).text('Low').attr('text-anchor', 'middle').attr(\"font-size\", 12).attr(\"fill\", \"#2b2828\")\n          svg.selectAll(\".myText\").data([0]).join(\"text\").attr(\"x\", item_width / 2).attr(\"class\", \"myText\").attr('dominant-baseline', \"middle\").attr(\"y\", 15).text('Attribute Importance').attr('text-anchor', 'middle').attr(\"font-size\", 12).attr(\"fill\", \"#2b2828\")\n          svg.selectAll(\".myText_high\").data([0]).join(\"text\").attr(\"x\", item_width-30).attr(\"class\", \"myText_high\").attr('dominant-baseline', \"middle\").attr(\"y\", 15).text('High').attr('text-anchor', 'middle').attr(\"font-size\", 12).attr(\"fill\", \"#2b2828\")\n          return item_height - marginBottom - marginTop\n        }\n        return item_height - marginBottom - marginTop\n      })\n      .attr('width', item_width)\n\n\n    feature_containers.attr(\"add_title_text_and_rect_for_title_text\", function (d, index) {\n      d3.select(this).selectAll(\".title_rect\").data([0]).join('rect').attr(\"class\", \"title_rect\").attr(\"myindex\", index).attr('feature_name', d[0]).attr(\"width\", \"100%\").attr(\"height\", title_rect_height).attr(\"fill\", \"#e2e2e2\").attr(\"y\", 0).attr(\"x\", 0)\n      d3.select(this).selectAll(\".title_text\").data([0]).join('text').attr(\"class\", \"title_text\")\n      .attr(\"myindex\", index).attr('feature_name', d[0]).attr('x', item_width / 2).text(d[0]).attr(\"dominant-baseline\", \"middle\")\n      .attr(\"y\", title_rect_height/2).attr('text-anchor', 'middle').attr('font-size', 14)\n    })\n    feature_containers.attr(\"add_cross_button\", function (d, index) {\n      d3.select(this).selectAll(\".cross_button\").data([0]).join(\"text\").attr('y', title_rect_height/2)\n        .attr('dominant-baseline', 'middle').attr(\"myindex\", index).attr('feature_name', d[0]).raise()\n        .attr('x', item_width - 15).style('cursor', 'pointer').attr('font-size', 14).attr('fill', 'black')\n        .text(\"\\uf410\").attr('class', \"cross_button fa make_cursor\").on('click', () => {\n          d3.event.preventDefault()\n          self.setState({ excluded_features: [...self.state.excluded_features, d[0]] })\n        })\n      //---\n      d3.select(this).selectAll(\".expand_button\").data([0]).join(\"text\").attr('y', title_rect_height/2)\n        .attr('dominant-baseline', 'middle').attr(\"myindex\", index).attr('feature_name', d[0]).raise()\n        .attr('x', item_width - 35).style('cursor', 'pointer').attr('font-size', 12).attr('fill', 'black')\n        .text(\"\\uf31e\").attr('class', \"expand_button fa make_cursor\").on('click', () => {\n          \n          self.props.Set_pop_over_models([self.props.model_name])\n\n          d3.event.preventDefault()\n          var feature = d[0]\n          var year = self.props.selected_year\n          d3.event.preventDefault()\n          var temp = [...self.props.dbclicked_features]\n          if (!temp.includes(feature)) {\n            temp.unshift(feature)\n            d3.selectAll(\".rect\").classed(\"exp_chart_clicked\", true)\n          }\n          self.props.set_dbclicked_features(temp)\n          //self.props.set_dbclicked_features([feature])\n          //----------------------------Data for popup chart\n          var popup_chart_data = {}\n          self.props.default_models.filter(item => item != \"ListNet\").map(model_name => {\n            var data = []\n            if (self.props.histogram_data.length > 0) {\n              data = self.props.lime_data[model_name].filter(element => { if ((parseInt(element['1-qid']) == parseInt(year)) && (self.props.histogram_data.includes(parseInt(element['two_realRank'])))) { return element } });\n            }\n            else {\n              data = self.props.lime_data[model_name].filter(element => parseInt(element['1-qid']) == parseInt(year) && selected_instances.includes(parseInt(element['two_realRank'])))\n            }\n            popup_chart_data[model_name] = data\n          })\n          self.props.Set_popup_chart_data([popup_chart_data, feature]) // This is to update the pop when the year or anything changes during the pop up is open\n          //self.props.Set_popup_chart_data([popup_chart_data, feature])\n          self.props.set_pop_over(true)\n        })\n      //---\n    })\n    feature_containers.attr(\"add_rect_for_circle_background_and_handle_clicks\", function (d, index) {\n      d3.select(this).selectAll(\".circ_rect\").data([0]).join('rect').attr(\"class\", \"circ_rect\").attr(\"myindex\", index).attr('feature_name', d[0]).attr(\"width\", \"100%\").attr(\"height\", item_height - title_rect_height).attr(\"fill\", \"#ffffff\").attr(\"y\", title_rect_height)\n        .on('click', () => {\n          if (self.props.clicked_features.includes(d[0])) {\n            self.props.Set_clicked_features(self.props.clicked_features.filter(item => item != d[0]))\n            d3.selectAll(\".\" + d[0]).selectAll(\".border_rect\").remove()\n          }\n          else {\n            self.props.Set_clicked_features([...self.props.clicked_features, d[0]])\n            d3.selectAll(\".\" + d[0]).selectAll(\".border_rect\").data([0]).join('rect').attr(\"class\", \"border_rect\").attr(\"width\", \"100%\").attr(\"height\", \"100%\").style(\"stroke\", \"black\").style(\"fill\", \"none\").style(\"stroke-width\", 5)\n          }\n        })\n    })\n    feature_containers.attr(\"CreatexpCircle\", function (d, index) {\n      CreatexpCircle(d, d3.select(this), selected_instances, self.props.lime_data, self.props.selected_year, [model_name], self.props.clicked_circles,\n        self.props.Set_clicked_circles, self.props.diverginColor, self.props.anim_config, item_width, item_height-(marginTop+marginBottom), self.props.deviation_array, index, self.props.threshold, self.props.dataset,title_rect_height,self.props.label_on,sorted_features)\n    })\n\n    feature_containers.attr('check_clicked_features', d => {\n      if (self.props.clicked_features.includes(d[0])) {\n        d3.selectAll(\".\" + d[0]).selectAll(\".border_rect\").data([0]).join('rect').attr(\"class\", \"border_rect\").attr(\"width\", \"100%\").attr(\"height\", \"100%\").style(\"stroke\", \"black\").style(\"fill\", \"none\").style(\"stroke-width\", 5)\n      }\n    })\n\n  }\n  //------------------------------\n  render() {\n    return (\n      <div key={this.props.model_name} className={\"explanation_chart_parent exp\" + this.props.model_name} style={{ width: '100%', height: '100%', \"border\": this.props.mode == 'Model' ? \"2px solid #e2e2e2\" : 'none', padding: \"2px 5px\" }}>\n        <p className=\"title_p\" style={{ padding: 0, margin: 0 }}>{this.props.model_name}</p>\n        <svg ref={this.exp} id={this.props.model_name} style={{ marginTop: this.state.mds_height, width: \"100%\" }}></svg>\n        <marker id=\"arrow\" markerUnits=\"strokeWidth\" markerWidth=\"12\" markerHeight=\"12\" viewBox=\"0 0 12 12\" refX=\"6\" refY=\"6\" orient=\"auto\">\n          <path d=\"M2,2 L10,6 L2,10 L6,6 L2,2\" style={{ fill: \"black\" }}></path>\n        </marker>\n      </div>\n    )\n  }\n}\nconst maptstateToprop = (state) => {\n  return {\n    deviation_array: state.deviation_array,\n    original_data: state.original_data,\n    time_mode_model: state.time_mode_model,\n    chart_scale_type: state.chart_scale_type,\n    dataset: state.dataset,\n    histogram_data: state.histogram_data,\n    sparkline_data: state.sparkline_data,\n    anim_config: state.anim_config,\n    show: state.show,\n    average_m: state.average_m,\n    average_y: state.average_y,\n    lime_data: state.lime_data,\n    rank_data: state.rank_data,\n    clicked_circles: state.clicked_circles,\n    clicked_features: state.clicked_features,\n    threshold: state.threshold,\n    mode: state.mode,\n    dbclicked_features: state.dbclicked_features,\n    dragged_features: state.dragged_features,\n    url: state.url,\n    default_models: state.default_models,\n    label_on:state.label_on,\n  }\n}\nconst mapdispatchToprop = (dispatch) => {\n  return {\n    Set_dragged_features: (val) => dispatch({ type: \"dragged_features\", value: val }),\n    Set_clicked_circles: (val) => dispatch({ type: \"clicked_circles\", value: val }),\n    Set_prev_prop: (val) => dispatch({ type: \"prev_prop\", value: val }),\n    Set_sparkline_data: (val) => dispatch({ type: \"sparkline_data\", value: val }),\n    Set_replay: (val) => dispatch({ type: \"replay\", value: val }),\n    Set_clicked_features: (val) => dispatch({ type: \"clicked_features\", value: val }),\n    Set_selected_year: (val) => dispatch({ type: \"selected_year\", value: val }),\n    set_dbclicked_features: (val) => dispatch({ type: \"dbclicked_features\", value: val }),\n    Set_popup_chart_data: (val) => dispatch({ type: \"popup_chart_data\", value: val }),\n    set_pop_over: (val) => dispatch({ type: \"pop_over\", value: val }),\n    Set_pop_over_models: (val) => dispatch({ type: \"pop_over_models\", value: val }),\n  }\n}\nexport default connect(maptstateToprop, mapdispatchToprop)(SlopeChart);"]},"metadata":{},"sourceType":"module"}