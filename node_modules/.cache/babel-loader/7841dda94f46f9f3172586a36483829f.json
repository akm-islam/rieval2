{"ast":null,"code":"import _toConsumableArray from\"/Users/kaustav/NewWork/trivea/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import*as d3 from\"d3\";import{createStore}from'redux';import reducer from\"../../../store/reducer\";var store=createStore(reducer);var state=store.getState();export default function CreatexpCircle(d,selection,selected_instances,lime_data,selected_year,default_models,clicked_circles,Set_clicked_circles,diverginColor,anim_config,item_width,item_height,deviation_array,index,threshold,dataset,title_rect_height,label_on,sorted_features){var margin={item_top_margin:title_rect_height+6,item_bottom_margin:8,circ_radius:5,item_left_margin:7,item_right_margin:7};var div=d3.select(\"body\").selectAll(\".tooltip\").data([0]).join('div').attr(\"class\",\"tooltip\").style(\"opacity\",0);var feature_contrib_name=d[0]+\"_contribution\";//-----------------Get Global range for scaling\nvar global_items=[];var biggest=0,b_feature=\"\",b_item=\"\";sorted_features.map(function(feature){lime_data[default_models[0]].map(function(item){if(selected_instances.includes(parseInt(item['two_realRank']))){global_items.push(parseFloat(item[feature[0]+\"_contribution\"]));if(parseFloat(item[feature[0]+\"_contribution\"])>biggest){biggest=parseFloat(item[feature[0]+\"_contribution\"]);b_feature=feature;b_item=item['two_realRank'];}}});});var global_range=d3.extent(global_items);//-----------------Get Global range for scaling\nvar circ_data=[];var sum_data=[];default_models.map(function(model){lime_data[model].map(function(item){// The following line filters out all negative \nif(item['1-qid']==selected_year&&selected_instances.includes(parseInt(item['two_realRank']))){if(item['deviation']<threshold){sum_data.push(parseFloat(item[feature_contrib_name]));}item['id']=item['State'].replace(/ /g,'').replace(/[^a-zA-Z ]/g,\"\");circ_data.push(item);}});});// Draw circle starts here\nvar xScale=d3.scaleLinear().domain(global_range).range([margin.item_left_margin,item_width-margin.item_right_margin]);//----------\nvar my_mean=d3.mean(sum_data);//----------\nselection.selectAll(\".my_mean_line\").data([0]).join(\"line\").attr(\"class\",\"my_mean_line\").attr(\"x1\",xScale(my_mean)).attr(\"x2\",xScale(my_mean)).attr(\"y1\",title_rect_height+3).attr(\"y2\",item_height).attr('stroke',\"rgb(96, 96, 96,0.5)\").attr('stroke-width',1);var rScale=d3.scalePow().exponent(0.4).domain(d3.extent(deviation_array)).range([state.global_config.max_circle_r,state.global_config.min_circle_r]);//console.log(circ_data)\nvar mycircles=selection.selectAll(\".my_circles\").data(circ_data,function(d){return d['id'];}).join(function(enter){return enter.append('circle').attr('id',function(d){return d['id'];}).attr('class',function(d){return'my_circles exp_circles';}).attr(\"transform\",function(d,i){var x_transform=xScale(parseFloat(d[feature_contrib_name]));var y_transform=getRandomArbitrary(margin.item_top_margin,item_height-margin.item_bottom_margin,i);if(label_on&&clicked_circles.includes(d['id'])){selection.selectAll(\".label\"+d['id']).data([0]).join(\"text\").attr(\"x\",x_transform-3).attr(\"class\",\"label\"+d['id']).attr('dominant-baseline',\"middle\").attr(\"y\",y_transform+13).text(d[\"two_realRank\"]).attr(\"opacity\",0.7).attr(\"font-size\",10);}else{selection.selectAll(\".label\"+d['id']).remove();}return\"translate(\"+x_transform+\",\"+y_transform+\")\";}).attr(\"r\",function(d){return d['deviation']>threshold?0:rScale(d['deviation']);});}// Update\n,function(update){return update.attr('class',function(d){return d['id']+' items exp_circles my_circles';}).transition().duration(anim_config.circle_animation).delay(anim_config.rank_animation+anim_config.deviation_animation+anim_config.feature_animation).attr(\"transform\",function(d,i){var x_transform=xScale(parseFloat(d[feature_contrib_name]));var y_transform=getRandomArbitrary(margin.item_top_margin,item_height-margin.item_bottom_margin,i);if(label_on&&clicked_circles.includes(d['id'])){selection.selectAll(\".label\"+d['id']).data([0]).join(\"text\").attr(\"x\",x_transform-3).attr(\"class\",\"label\"+d['id']).attr('dominant-baseline',\"middle\").attr(\"y\",y_transform+13).text(d[\"two_realRank\"]).attr(\"opacity\",0.7).attr(\"font-size\",10);}else{selection.selectAll(\".label\"+d['id']).remove();}return\"translate(\"+x_transform+\",\"+y_transform+\")\";}).attr('id',function(d){return d['id'];}).attr(\"r\",function(d){return d['deviation']>threshold?0:rScale(d['deviation']);});},function(exit){return exit.remove();});mycircles.attr(\"myindex\",index).attr('feature_name',d[0]).attr(\"fill\",function(d){return diverginColor(d['two_realRank']).replace(\")\",\",.7)\");}).attr(\"stroke\",function(d){if(clicked_circles.includes(d['id'])){return\"rgb(227, 26, 28,0.75)\";}}).attr(\"handle_opacity\",function(d){if(clicked_circles.length==0){d3.selectAll(\".my_circles\").attr(\"opacity\",1);}if(clicked_circles.includes(d['id'])){d3.select(this).attr(\"opacity\",1);}else{d3.select(this).attr(\"opacity\",0.3);}}).on('click',function(d){Set_clicked_circles(clicked_circles.includes(d['id'])?clicked_circles.filter(function(item){return item!=d['id'];}):[].concat(_toConsumableArray(clicked_circles),[d['id']]));}).style(\"stroke-width\",function(d){if(clicked_circles.includes(d['id'])){d3.select(this).raise();return 2.5;}});if(index==0){selection.selectAll(\".avg_text\").data(['avg']).join(\"text\").attr(\"x\",xScale(my_mean)).attr(\"class\",\"avg_text\").attr(\"myindex\",index).attr(\"y\",(item_height-margin.item_top_margin-margin.item_bottom_margin)/2+margin.item_top_margin-18).text('avg').attr('font-size',12).attr('dominant-baseline',\"middle\").attr('text-anchor','middle').attr('transform',function(d){return\"rotate(-90,\"+(xScale(my_mean)+5)+\",\"+((item_height-margin.item_top_margin-margin.item_bottom_margin)/2+margin.item_top_margin)+\")\";});}else{selection.selectAll('.avg_text').remove();}mycircles.on(\"mouseover\",function(d){div.transition().duration(200).style(\"opacity\",.9);div.html(\"<p>Name: \"+d['State']+\"</p>\"+\"<p>Ground Truth: \"+d['two_realRank']+\"</p>Model Outcome: \"+d['predicted']+\"</p>\").style(\"left\",d3.event.pageX+\"px\").style(\"top\",d3.event.pageY+12+\"px\");}).on(\"mouseout\",function(d){return div.transition().duration(200).style(\"opacity\",0);}).attr(\"global_range\",global_range).attr(\"scaled_value\",function(d){return d[feature_contrib_name]+\"-----\"+xScale(parseFloat(d[feature_contrib_name]));});// Draw circle ends here\nfunction getRandomArbitrary(min,max,seed){min=min||0;max=max||1;var rand;if(typeof seed===\"number\"){seed=(seed*9301+49297)%233280;var rnd=seed/233280;var disp=Math.abs(Math.sin(seed));rnd=rnd+disp-Math.floor(rnd+disp);rand=Math.floor(min+rnd*(max-min+1));}else{rand=Math.floor(Math.random()*(max-min+1))+min;}return rand;}}","map":{"version":3,"sources":["/Users/kaustav/NewWork/trivea/src/components/Charts/ExpChart/Create_exp_circles.js"],"names":["d3","createStore","reducer","store","state","getState","CreatexpCircle","d","selection","selected_instances","lime_data","selected_year","default_models","clicked_circles","Set_clicked_circles","diverginColor","anim_config","item_width","item_height","deviation_array","index","threshold","dataset","title_rect_height","label_on","sorted_features","margin","item_top_margin","item_bottom_margin","circ_radius","item_left_margin","item_right_margin","div","select","selectAll","data","join","attr","style","feature_contrib_name","global_items","biggest","b_feature","b_item","map","feature","item","includes","parseInt","push","parseFloat","global_range","extent","circ_data","sum_data","model","replace","xScale","scaleLinear","domain","range","my_mean","mean","rScale","scalePow","exponent","global_config","max_circle_r","min_circle_r","mycircles","enter","append","i","x_transform","y_transform","getRandomArbitrary","text","remove","update","transition","duration","circle_animation","delay","rank_animation","deviation_animation","feature_animation","exit","length","on","filter","raise","html","event","pageX","pageY","min","max","seed","rand","rnd","disp","Math","abs","sin","floor","random"],"mappings":"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","sourcesContent":["import * as d3 from \"d3\";\nimport { createStore } from 'redux';\nimport reducer from \"../../../store/reducer\";\nconst store = createStore(reducer);\nconst state = store.getState();\nexport default function CreatexpCircle(d, selection, selected_instances,\n    lime_data, selected_year, default_models, clicked_circles, Set_clicked_circles, diverginColor, anim_config, item_width, item_height,\n    deviation_array, index, threshold, dataset, title_rect_height, label_on,sorted_features) {\n    var margin = { item_top_margin: title_rect_height+6, item_bottom_margin: 8, circ_radius: 5, item_left_margin: 7, item_right_margin: 7 }\n    var div = d3.select(\"body\").selectAll(\".tooltip\").data([0]).join('div').attr(\"class\", \"tooltip\").style(\"opacity\", 0);\n\n    var feature_contrib_name = d[0] + \"_contribution\"\n    //-----------------Get Global range for scaling\n\n    var global_items = []\n    var biggest=0,b_feature=\"\",b_item=\"\"\n    sorted_features.map(feature => {\n        lime_data[default_models[0]].map(item => {\n            if (selected_instances.includes(parseInt(item['two_realRank']))) {\n                global_items.push(parseFloat(item[feature[0] + \"_contribution\"]))\n                if(parseFloat(item[feature[0] + \"_contribution\"])>biggest){\n                    biggest=parseFloat(item[feature[0] + \"_contribution\"])\n                    b_feature=feature\n                    b_item=item['two_realRank']\n                }\n            }\n        })\n    })\n    var global_range=d3.extent(global_items)\n    //-----------------Get Global range for scaling\n    var circ_data = []\n    var sum_data = []\n    default_models.map(model => {\n        lime_data[model].map(item => {\n            // The following line filters out all negative \n            if (item['1-qid'] == selected_year && selected_instances.includes(parseInt(item['two_realRank']))) {\n                if (item['deviation'] < threshold) { sum_data.push(parseFloat(item[feature_contrib_name])) }\n                item['id'] = item['State'].replace(/ /g, '').replace(/[^a-zA-Z ]/g, \"\")\n                circ_data.push(item)\n            }\n        })\n    })\n    // Draw circle starts here\n    var xScale = d3.scaleLinear().domain(global_range).range([margin.item_left_margin, item_width - margin.item_right_margin])\n    //----------\n    var my_mean = d3.mean(sum_data)\n    //----------\n    selection.selectAll(\".my_mean_line\").data([0]).join(\"line\").attr(\"class\", \"my_mean_line\").attr(\"x1\", xScale(my_mean)).attr(\"x2\", xScale(my_mean)).attr(\"y1\", title_rect_height + 3).attr(\"y2\", item_height).attr('stroke', \"rgb(96, 96, 96,0.5)\").attr('stroke-width', 1)\n    var rScale = d3.scalePow().exponent(0.4).domain(d3.extent(deviation_array)).range([state.global_config.max_circle_r, state.global_config.min_circle_r])\n    //console.log(circ_data)\n    var mycircles = selection.selectAll(\".my_circles\").data(circ_data, d => d['id']).join(\n        enter => enter.append('circle')\n            .attr('id', d => d['id'])\n            .attr('class', d => 'my_circles exp_circles')\n            .attr(\"transform\", function (d, i) {\n                var x_transform = xScale(parseFloat(d[feature_contrib_name]))\n                var y_transform = getRandomArbitrary(margin.item_top_margin, item_height - margin.item_bottom_margin, i)\n                if (label_on && clicked_circles.includes(d['id'])) {\n                    selection.selectAll(\".label\" + d['id']).data([0]).join(\"text\").attr(\"x\", x_transform - 3).attr(\"class\", \"label\" + d['id']).attr('dominant-baseline', \"middle\").attr(\"y\", y_transform + 13).text(d[\"two_realRank\"]).attr(\"opacity\", 0.7).attr(\"font-size\", 10)\n                }\n                else {\n                    selection.selectAll(\".label\" + d['id']).remove()\n                }\n                return \"translate(\" + x_transform + \",\" + y_transform + \")\";\n            })\n            .attr(\"r\", d => d['deviation'] > threshold ? 0 : rScale(d['deviation']))\n        // Update\n        , update => update.attr('class', d => d['id'] + ' items exp_circles my_circles')\n            .transition().duration(anim_config.circle_animation).delay(anim_config.rank_animation + anim_config.deviation_animation + anim_config.feature_animation)\n            .attr(\"transform\", function (d, i) {\n                var x_transform = xScale(parseFloat(d[feature_contrib_name]))\n                var y_transform = getRandomArbitrary(margin.item_top_margin, item_height - margin.item_bottom_margin, i)\n                if (label_on && clicked_circles.includes(d['id'])) {\n                    selection.selectAll(\".label\" + d['id']).data([0]).join(\"text\").attr(\"x\", x_transform - 3).attr(\"class\", \"label\" + d['id']).attr('dominant-baseline', \"middle\").attr(\"y\", y_transform + 13).text(d[\"two_realRank\"]).attr(\"opacity\", 0.7).attr(\"font-size\", 10)\n                }\n                else {\n                    selection.selectAll(\".label\" + d['id']).remove()\n                }\n                return \"translate(\" + x_transform + \",\" + y_transform + \")\";\n            })\n            .attr('id', d => d['id'])\n            .attr(\"r\", d => d['deviation'] > threshold ? 0 : rScale(d['deviation']))\n        , exit => exit.remove())\n\n    mycircles.attr(\"myindex\", index).attr('feature_name', d[0])\n        .attr(\"fill\", d => diverginColor(d['two_realRank']).replace(\")\", \",.7)\")).attr(\"stroke\", (d) => {\n            if (clicked_circles.includes(d['id'])) {\n                return \"rgb(227, 26, 28,0.75)\"\n            }\n        })\n        .attr(\"handle_opacity\", function (d) {\n            if (clicked_circles.length == 0) { d3.selectAll(\".my_circles\").attr(\"opacity\", 1) }\n            if (clicked_circles.includes(d['id'])) {\n                d3.select(this).attr(\"opacity\", 1)\n            }\n            else {\n                d3.select(this).attr(\"opacity\", 0.3)\n            }\n        })\n        .on('click', function (d) {\n            Set_clicked_circles(clicked_circles.includes(d['id']) ? clicked_circles.filter(item => item != d['id']) : [...clicked_circles, d['id']])\n        })\n\n        .style(\"stroke-width\", function (d) {\n            if (clicked_circles.includes(d['id'])) {\n                d3.select(this).raise()\n                return 2.5\n            }\n        })\n\n    if (index == 0) {\n        selection.selectAll(\".avg_text\").data(['avg']).join(\"text\").attr(\"x\", xScale(my_mean)).attr(\"class\", \"avg_text\").attr(\"myindex\", index).attr(\"y\", (item_height - margin.item_top_margin - margin.item_bottom_margin) / 2 + margin.item_top_margin -18).text('avg').attr('font-size', 12)\n            .attr('dominant-baseline', \"middle\").attr('text-anchor', 'middle').attr('transform', d => \"rotate(-90,\" + (xScale(my_mean) + 5) + \",\" + ((item_height - margin.item_top_margin - margin.item_bottom_margin) / 2 + margin.item_top_margin) + \")\")\n    }\n    else { selection.selectAll('.avg_text').remove() }\n\n    mycircles.on(\"mouseover\", d => {\n        div.transition().duration(200).style(\"opacity\", .9);\n        div.html(\"<p>Name: \" + d['State'] + \"</p>\" + \"<p>Ground Truth: \" + d['two_realRank'] + \"</p>Model Outcome: \" + d['predicted'] + \"</p>\").style(\"left\", (d3.event.pageX) + \"px\").style(\"top\", (d3.event.pageY + 12) + \"px\")\n    }).on(\"mouseout\", d => div.transition().duration(200).style(\"opacity\", 0))\n    .attr(\"global_range\",global_range)\n    .attr(\"scaled_value\",d=>d[feature_contrib_name]+\"-----\"+xScale(parseFloat(d[feature_contrib_name])))\n\n    // Draw circle ends here\n    function getRandomArbitrary(min, max, seed) {\n        min = min || 0;\n        max = max || 1;\n        var rand;\n        if (typeof seed === \"number\") {\n            seed = (seed * 9301 + 49297) % 233280;\n            var rnd = seed / 233280;\n            var disp = Math.abs(Math.sin(seed));\n            rnd = (rnd + disp) - Math.floor((rnd + disp));\n            rand = Math.floor(min + rnd * (max - min + 1));\n        } else {\n            rand = Math.floor(Math.random() * (max - min + 1)) + min;\n        }\n        return rand;\n    }\n}"]},"metadata":{},"sourceType":"module"}