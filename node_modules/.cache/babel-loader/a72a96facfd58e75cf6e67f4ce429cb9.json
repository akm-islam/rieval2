{"ast":null,"code":"var _jsxFileName = \"/Users/kaustav/NewWork/trivea/src/components/Charts/Time/02ExpChartComponentTime.js\";\nimport React, { Component } from 'react';\nimport * as d3 from 'd3';\nimport { connect } from \"react-redux\";\nimport * as algo1 from \"../../../Algorithms/algo1\";\nimport * as $ from 'jquery';\nimport CreatexpCircle from \"../ExpChart/Create_exp_circles\";\nimport \"../ExpChart/MDS.css\";\n\nclass SlopeChart extends Component {\n  constructor(props) {\n    super(props);\n\n    this.Createsvg = (model_name, exp_id, state_range, selected_year) => {\n      var self = this;\n      var selected_instances = d3.range(state_range[0], state_range[1] + 1);\n\n      if (this.props.histogram_data.length > 0) {\n        selected_instances = this.props.histogram_data;\n      } //-------------------- Threshold filter\n\n\n      var under_threshold_instances = [];\n      var year_data = this.props.original_data.filter(item => this.props.selected_year == item['1-qid']);\n      this.props.default_models.map(model_name => {\n        year_data.map(item => {\n          var two_realRank = parseInt(item['two_realRank']);\n          var predicted_rank = parseInt(item[model_name]);\n\n          if (Math.abs(predicted_rank - two_realRank) > this.props.threshold) {\n            under_threshold_instances.push(two_realRank);\n          }\n        });\n      });\n      selected_instances = selected_instances.filter(item => !under_threshold_instances.includes(item)); //--------------------\n      //------------------------------\n\n      var number_of_charts = 8 + self.state.excluded_features.length;\n      var indexed_features = algo1.getSortedFeatures(this.props.lime_data[model_name], selected_instances, this.props.selected_year);\n      var temp_sorted_features = indexed_features.filter(item => !this.state.excluded_features.includes(item)); // Exclude crossed features \n\n      var sorted_features = temp_sorted_features.slice(0, number_of_charts).map((item, index) => [item, index]);\n      var marginTop = 5,\n          marginBottom = 10;\n      var parent_height = parseInt($('.explanation_chart_parent').height()) - this.state.mds_height - parseInt($('.title_p').height());\n      var item_width = parseInt($(\"#\" + this.props.exp_id).width());\n      var item_height = (parent_height - 10) / sorted_features.length - marginTop; // 10 is the top margin\n\n      var feature_containers = d3.select('#' + this.props.exp_id).attr('height', parent_height).selectAll(\".feature_items\").data(sorted_features, d => d[0]).join(enter => enter.append(\"svg\").attr(\"y\", (d, i) => marginTop + i * (item_height + marginTop)), update => update.transition().duration(2000).attr(\"y\", (d, i) => marginTop + i * (item_height + marginTop)), exit => exit.remove());\n      feature_containers.attr(\"class\", d => \"feature_items \" + d[0]).attr(\"myindex\", (d, i) => i).attr('feature_name', d => d[0]);\n      feature_containers.attr(\"add_title_text_and_rect_for_title_text\", function (d, index) {\n        d3.select(this).selectAll(\".title_rect\").data([0]).join('rect').attr(\"class\", \"title_rect\").attr(\"myindex\", index).attr('feature_name', d[0]).attr(\"width\", \"100%\").attr(\"height\", 18).attr(\"fill\", \"#e2e2e2\").attr(\"y\", 0).attr(\"x\", 0);\n        d3.select(this).selectAll(\".title_text\").data([0]).join('text').attr(\"class\", \"title_text\").attr(\"myindex\", index).attr('feature_name', d[0]).attr('x', item_width / 2).text(d[0]).attr(\"dominant-baseline\", \"hanging\").attr(\"y\", 2).attr('text-anchor', 'middle').attr('font-size', 12);\n      });\n      feature_containers.attr(\"add_cross_button\", function (d, index) {\n        d3.select(this).selectAll(\".cross_button\").data([0]).join(\"text\").attr('y', 7.3).attr('dominant-baseline', 'middle').attr(\"myindex\", index).attr('feature_name', d[0]).raise().attr('x', item_width - 15).style('cursor', 'pointer').attr('font-size', 14).attr('fill', 'black').text(\"\\uf410\").attr('class', \"cross_button fa make_cursor\").on('click', () => {\n          //alert(\"clicked!\")\n          d3.event.preventDefault();\n          self.setState({\n            excluded_features: [...self.state.excluded_features, d[0]]\n          });\n        }); //---\n\n        d3.select(this).selectAll(\".expand_button\").data([0]).join(\"text\").attr('y', 7.3).attr('dominant-baseline', 'middle').attr(\"myindex\", index).attr('feature_name', d[0]).raise().attr('x', item_width - 35).style('cursor', 'pointer').attr('font-size', 12).attr('fill', 'black').text(\"\\uf31e\").attr('class', \"expand_button fa make_cursor\").on('click', () => {\n          var feature = d[0];\n          var year = selected_year;\n          d3.event.preventDefault();\n          var temp = [...self.props.dbclicked_features];\n\n          if (!temp.includes(feature)) {\n            temp.unshift(feature);\n            d3.selectAll(\".rect\").classed(\"exp_chart_clicked\", true);\n          }\n\n          self.props.set_dbclicked_features(temp); //self.props.set_dbclicked_features([feature])\n          //----------------------------Data for popup chart\n\n          var popup_chart_data = {};\n          self.props.default_models.filter(item => item != \"ListNet\").map(model_name => {\n            var data = [];\n\n            if (self.props.histogram_data.length > 0) {\n              data = self.props.lime_data[model_name].filter(element => {\n                if (parseInt(element['1-qid']) == parseInt(year) && self.props.histogram_data.includes(parseInt(element['two_realRank']))) {\n                  return element;\n                }\n              });\n            } else {\n              data = self.props.lime_data[model_name].filter(element => parseInt(element['1-qid']) == parseInt(year) && selected_instances.includes(parseInt(element['two_realRank'])));\n            }\n\n            popup_chart_data[model_name] = data;\n          });\n          self.props.Set_popup_chart_data([popup_chart_data, feature]); // This is to update the pop when the year or anything changes during the pop up is open\n          //self.props.Set_popup_chart_data([popup_chart_data, feature])\n\n          self.props.set_pop_over(true);\n        }); //---\n      });\n      feature_containers.attr(\"add_rect_for_circle_background_and_handle_clicks\", function (d, index) {\n        d3.select(this).selectAll(\".circ_rect\").data([0]).join('rect').attr(\"class\", \"circ_rect\").attr(\"myindex\", index).attr('feature_name', d[0]).attr(\"width\", \"100%\").attr(\"height\", item_height - 18).attr(\"fill\", \"#f2f2f2\").attr(\"y\", 18).attr(\"x\", 0).on('click', () => {\n          if (self.props.clicked_features.includes(d[0])) {\n            self.props.Set_clicked_features(self.props.clicked_features.filter(item => item != d[0]));\n            d3.selectAll(\".\" + d[0]).selectAll(\".border_rect\").remove();\n          } else {\n            self.props.Set_clicked_features([...self.props.clicked_features, d[0]]);\n            d3.selectAll(\".\" + d[0]).selectAll(\".border_rect\").data([0]).join('rect').attr(\"class\", \"border_rect\").attr(\"width\", \"100%\").attr(\"height\", \"100%\").style(\"stroke\", \"black\").style(\"fill\", \"none\").style(\"stroke-width\", 5);\n          }\n        });\n      });\n      feature_containers.attr(\"CreatexpCircle\", function (d, index) {\n        var title_rect_height = 16;\n        CreatexpCircle(d, d3.select(this), selected_instances, self.props.lime_data, selected_year, [model_name], self.props.clicked_circles, self.props.Set_clicked_circles, self.props.diverginColor, self.props.anim_config, item_width, item_height - (marginTop + marginBottom), self.props.deviation_array, index, self.props.threshold, self.props.dataset, title_rect_height, 'label_on', sorted_features);\n      }).attr(\"height\", function (d) {\n        if (d[1] == sorted_features.length - 1) {\n          var ft_svg_height = 25;\n          var svg = d3.select(this.parentNode).selectAll(\".ft_svg\").data([0]).join(\"svg\").attr(\"x\", 0).attr(\"y\", parent_height - ft_svg_height).attr(\"class\", \"ft_svg\").attr(\"width\", item_width).attr(\"height\", ft_svg_height);\n          var markerBoxWidth = 8,\n              markerBoxHeight = 8,\n              refX = markerBoxWidth / 2,\n              refY = markerBoxHeight / 2;\n          svg.append('defs').append('marker').attr('id', 'arrow').attr('viewBox', [0, 0, markerBoxWidth, markerBoxHeight]).attr('refX', refX).attr('refY', refY).attr('markerWidth', markerBoxWidth).attr('markerHeight', markerBoxHeight).attr('orient', 'auto-start-reverse').append('path').attr('d', d3.line()([[0, 0], [0, 7], [7, 3.8]])).attr('stroke', '#777777').attr(\"fill\", \"#777777\"); //------------------------------------------------[[x2, y2], [x1, y1]]\n\n          svg.append('path').attr('d', d3.line()([[item_width / 2 - 65, 15], [50, 15]])).attr('stroke', '#777777').attr('marker-end', 'url(#arrow)').attr('fill', 'none');\n          svg.append('path').attr('d', d3.line()([[item_width - 50, 15], [65 + item_width / 2, 15]])).attr('stroke', '#777777').attr('marker-start', 'url(#arrow)').attr('fill', 'none');\n          svg.selectAll(\".myText_low\").data([0]).join(\"text\").attr(\"x\", 30).attr(\"class\", \"myText_low\").attr('dominant-baseline', \"middle\").attr(\"y\", 15).text('Low').attr('text-anchor', 'middle').attr(\"font-size\", 12).attr(\"fill\", \"#2b2828\");\n          svg.selectAll(\".myText\").data([0]).join(\"text\").attr(\"x\", item_width / 2).attr(\"class\", \"myText\").attr('dominant-baseline', \"middle\").attr(\"y\", 15).text('attribute Importance').attr('text-anchor', 'middle').attr(\"font-size\", 12).attr(\"fill\", \"#2b2828\");\n          svg.selectAll(\".myText_high\").data([0]).join(\"text\").attr(\"x\", item_width - 30).attr(\"class\", \"myText_high\").attr('dominant-baseline', \"middle\").attr(\"y\", 15).text('High').attr('text-anchor', 'middle').attr(\"font-size\", 12).attr(\"fill\", \"#2b2828\");\n          return item_height - marginBottom - marginTop;\n        }\n\n        return item_height - marginBottom - marginTop;\n      }).attr('width', item_width);\n      feature_containers.attr('check_clicked_features', d => {\n        if (self.props.clicked_features.includes(d[0])) {\n          d3.selectAll(\".\" + d[0]).selectAll(\".border_rect\").data([0]).join('rect').attr(\"class\", \"border_rect\").attr(\"width\", \"100%\").attr(\"height\", \"100%\").style(\"stroke\", \"black\").style(\"fill\", \"none\").style(\"stroke-width\", 5);\n        }\n      });\n    };\n\n    this.mds = React.createRef();\n    this.state = {\n      mds_height: 10,\n      mouseX: 0,\n      mouseY: 0,\n      excluded_features: [],\n      sorted_features: null,\n      circle_data: null,\n      indexed_features: null,\n      random: true\n    };\n  }\n\n  componentDidMount() {\n    this.setState({\n      width: window.innerHeight\n    });\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    this.Createsvg(this.props.model_name, this.props.exp_id, this.props.state_range, this.props.selected_year);\n  }\n\n  //------------------------------\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"explanation_chart_parent exp\" + this.props.model_name,\n      style: {\n        width: '100%',\n        height: '100%',\n        \"border\": this.props.mode == 'Model' ? \"2px solid #e2e2e2\" : 'none',\n        padding: \"2px 5px\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 149,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"p\", {\n      className: \"title_p\",\n      style: {\n        padding: 0,\n        margin: 0\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 150,\n        columnNumber: 9\n      }\n    }, this.props.model_name), /*#__PURE__*/React.createElement(\"svg\", {\n      id: this.props.exp_id,\n      style: {\n        marginTop: this.state.mds_height,\n        width: \"100%\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 151,\n        columnNumber: 9\n      }\n    }), /*#__PURE__*/React.createElement(\"marker\", {\n      id: \"arrow\",\n      markerUnits: \"strokeWidth\",\n      markerWidth: \"12\",\n      markerHeight: \"12\",\n      viewBox: \"0 0 12 12\",\n      refX: \"6\",\n      refY: \"6\",\n      orient: \"auto\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 152,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"path\", {\n      d: \"M2,2 L10,6 L2,10 L6,6 L2,2\",\n      style: {\n        fill: \"black\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 153,\n        columnNumber: 11\n      }\n    })));\n  }\n\n}\n\nconst maptstateToprop = state => {\n  return {\n    deviation_array: state.deviation_array,\n    original_data: state.original_data,\n    time_mode_model: state.time_mode_model,\n    chart_scale_type: state.chart_scale_type,\n    dataset: state.dataset,\n    histogram_data: state.histogram_data,\n    sparkline_data: state.sparkline_data,\n    anim_config: state.anim_config,\n    show: state.show,\n    average_m: state.average_m,\n    average_y: state.average_y,\n    lime_data: state.lime_data,\n    rank_data: state.rank_data,\n    clicked_circles: state.clicked_circles,\n    clicked_features: state.clicked_features,\n    threshold: state.threshold,\n    mode: state.mode,\n    dbclicked_features: state.dbclicked_features,\n    dragged_features: state.dragged_features,\n    url: state.url\n  };\n};\n\nconst mapdispatchToprop = dispatch => {\n  return {\n    Set_dragged_features: val => dispatch({\n      type: \"dragged_features\",\n      value: val\n    }),\n    Set_clicked_circles: val => dispatch({\n      type: \"clicked_circles\",\n      value: val\n    }),\n    Set_prev_prop: val => dispatch({\n      type: \"prev_prop\",\n      value: val\n    }),\n    Set_sparkline_data: val => dispatch({\n      type: \"sparkline_data\",\n      value: val\n    }),\n    Set_replay: val => dispatch({\n      type: \"replay\",\n      value: val\n    }),\n    Set_clicked_features: val => dispatch({\n      type: \"clicked_features\",\n      value: val\n    }),\n    Set_selected_year: val => dispatch({\n      type: \"selected_year\",\n      value: val\n    }),\n    set_dbclicked_features: val => dispatch({\n      type: \"dbclicked_features\",\n      value: val\n    }),\n    Set_popup_chart_data: val => dispatch({\n      type: \"popup_chart_data\",\n      value: val\n    }),\n    set_pop_over: val => dispatch({\n      type: \"pop_over\",\n      value: val\n    }),\n    Set_deviation_array: val => dispatch({\n      type: \"deviation_array\",\n      value: val\n    })\n  };\n};\n\nexport default connect(maptstateToprop, mapdispatchToprop)(SlopeChart);","map":{"version":3,"sources":["/Users/kaustav/NewWork/trivea/src/components/Charts/Time/02ExpChartComponentTime.js"],"names":["React","Component","d3","connect","algo1","$","CreatexpCircle","SlopeChart","constructor","props","Createsvg","model_name","exp_id","state_range","selected_year","self","selected_instances","range","histogram_data","length","under_threshold_instances","year_data","original_data","filter","item","default_models","map","two_realRank","parseInt","predicted_rank","Math","abs","threshold","push","includes","number_of_charts","state","excluded_features","indexed_features","getSortedFeatures","lime_data","temp_sorted_features","sorted_features","slice","index","marginTop","marginBottom","parent_height","height","mds_height","item_width","width","item_height","feature_containers","select","attr","selectAll","data","d","join","enter","append","i","update","transition","duration","exit","remove","text","raise","style","on","event","preventDefault","setState","feature","year","temp","dbclicked_features","unshift","classed","set_dbclicked_features","popup_chart_data","element","Set_popup_chart_data","set_pop_over","clicked_features","Set_clicked_features","title_rect_height","clicked_circles","Set_clicked_circles","diverginColor","anim_config","deviation_array","dataset","ft_svg_height","svg","parentNode","markerBoxWidth","markerBoxHeight","refX","refY","line","mds","createRef","mouseX","mouseY","circle_data","random","componentDidMount","window","innerHeight","componentDidUpdate","prevProps","prevState","render","mode","padding","margin","fill","maptstateToprop","time_mode_model","chart_scale_type","sparkline_data","show","average_m","average_y","rank_data","dragged_features","url","mapdispatchToprop","dispatch","Set_dragged_features","val","type","value","Set_prev_prop","Set_sparkline_data","Set_replay","Set_selected_year","Set_deviation_array"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport * as d3 from 'd3';\nimport { connect } from \"react-redux\";\nimport * as algo1 from \"../../../Algorithms/algo1\";\nimport * as $ from 'jquery';\nimport CreatexpCircle from \"../ExpChart/Create_exp_circles\"\nimport \"../ExpChart/MDS.css\"\nclass SlopeChart extends Component {\n  constructor(props) {\n    super(props);\n    this.mds = React.createRef()\n    this.state = { mds_height: 10, mouseX: 0, mouseY: 0, excluded_features: [], sorted_features: null, circle_data: null, indexed_features: null, random: true }\n  }\n  componentDidMount() {\n    this.setState({ width: window.innerHeight })\n  }\n  componentDidUpdate(prevProps, prevState) {\n    this.Createsvg(this.props.model_name,this.props.exp_id,this.props.state_range,this.props.selected_year)\n  }\n  Createsvg = (model_name,exp_id,state_range,selected_year) => {\n    var self = this\n    var selected_instances = d3.range(state_range[0], state_range[1] + 1)\n    if (this.props.histogram_data.length > 0) { selected_instances = this.props.histogram_data }\n    //-------------------- Threshold filter\n    var under_threshold_instances = []\n    var year_data = this.props.original_data.filter(item => this.props.selected_year == item['1-qid'])\n    this.props.default_models.map(model_name => {\n      year_data.map(item => {\n        var two_realRank = parseInt(item['two_realRank'])\n        var predicted_rank = parseInt(item[model_name])\n        if (Math.abs(predicted_rank - two_realRank) > this.props.threshold) {\n          under_threshold_instances.push(two_realRank)\n        }\n      })\n    })\n    selected_instances = selected_instances.filter(item => !under_threshold_instances.includes(item))\n    //--------------------\n\n    //------------------------------\n    var number_of_charts = 8 + self.state.excluded_features.length\n   \n    var indexed_features = algo1.getSortedFeatures(this.props.lime_data[model_name],selected_instances, this.props.selected_year)\n    var temp_sorted_features = indexed_features.filter(item => !this.state.excluded_features.includes(item))// Exclude crossed features \n    var sorted_features = temp_sorted_features.slice(0, number_of_charts).map((item, index) => [item, index])\n    \n    var marginTop = 5,marginBottom = 10\n    var parent_height = parseInt($('.explanation_chart_parent').height()) - this.state.mds_height - parseInt($('.title_p').height())\n    var item_width = parseInt($(\"#\" + this.props.exp_id).width())\n    var item_height = (parent_height - 10) / sorted_features.length - marginTop // 10 is the top margin\n    var feature_containers = d3.select('#' + this.props.exp_id).attr('height', parent_height).selectAll(\".feature_items\").data(sorted_features, d => d[0])\n      .join(enter => enter.append(\"svg\").attr(\"y\", (d, i) => marginTop + i * (item_height + marginTop))\n        , update => update.transition().duration(2000).attr(\"y\", (d, i) => marginTop + i * (item_height + marginTop))\n        , exit => exit.remove()\n      )\n    feature_containers.attr(\"class\", d => \"feature_items \" + d[0]).attr(\"myindex\", (d, i) => i).attr('feature_name', d => d[0])\n    feature_containers.attr(\"add_title_text_and_rect_for_title_text\", function (d, index) {\n      d3.select(this).selectAll(\".title_rect\").data([0]).join('rect').attr(\"class\", \"title_rect\").attr(\"myindex\", index).attr('feature_name', d[0]).attr(\"width\", \"100%\").attr(\"height\", 18).attr(\"fill\", \"#e2e2e2\").attr(\"y\", 0).attr(\"x\", 0)\n      d3.select(this).selectAll(\".title_text\").data([0]).join('text').attr(\"class\", \"title_text\").attr(\"myindex\", index).attr('feature_name', d[0]).attr('x', item_width / 2).text(d[0]).attr(\"dominant-baseline\", \"hanging\")\n        .attr(\"y\", 2).attr('text-anchor', 'middle').attr('font-size', 12)\n    })\n    feature_containers.attr(\"add_cross_button\", function (d, index) {\n      d3.select(this).selectAll(\".cross_button\").data([0]).join(\"text\").attr('y', 7.3).attr('dominant-baseline', 'middle').attr(\"myindex\", index).attr('feature_name', d[0]).raise()\n        .attr('x', item_width - 15).style('cursor', 'pointer').attr('font-size', 14).attr('fill', 'black')\n        .text(\"\\uf410\").attr('class', \"cross_button fa make_cursor\").on('click', () => {\n          //alert(\"clicked!\")\n          d3.event.preventDefault()\n          self.setState({ excluded_features: [...self.state.excluded_features, d[0]] })\n        })\n        //---\n        d3.select(this).selectAll(\".expand_button\").data([0]).join(\"text\").attr('y', 7.3)\n        .attr('dominant-baseline', 'middle').attr(\"myindex\", index).attr('feature_name', d[0]).raise()\n        .attr('x', item_width - 35).style('cursor', 'pointer').attr('font-size', 12).attr('fill', 'black')\n        .text(\"\\uf31e\").attr('class', \"expand_button fa make_cursor\").on('click', () => {\n          var feature = d[0]\n          var year = selected_year\n          d3.event.preventDefault()\n          var temp = [...self.props.dbclicked_features]\n          if (!temp.includes(feature)) {\n            temp.unshift(feature)\n            d3.selectAll(\".rect\").classed(\"exp_chart_clicked\", true)\n          }\n          self.props.set_dbclicked_features(temp)\n          //self.props.set_dbclicked_features([feature])\n          //----------------------------Data for popup chart\n          var popup_chart_data = {}\n          self.props.default_models.filter(item => item != \"ListNet\").map(model_name => {\n            var data = []\n            if (self.props.histogram_data.length > 0) {\n              data = self.props.lime_data[model_name].filter(element => { if ((parseInt(element['1-qid']) == parseInt(year)) && (self.props.histogram_data.includes(parseInt(element['two_realRank'])))) { return element } });\n            }\n            else {\n              data = self.props.lime_data[model_name].filter(element => parseInt(element['1-qid']) == parseInt(year) && selected_instances.includes(parseInt(element['two_realRank'])))\n            }\n            popup_chart_data[model_name] = data\n          })\n          self.props.Set_popup_chart_data([popup_chart_data, feature]) // This is to update the pop when the year or anything changes during the pop up is open\n          //self.props.Set_popup_chart_data([popup_chart_data, feature])\n          self.props.set_pop_over(true)\n        })\n        //---\n    })\n    feature_containers.attr(\"add_rect_for_circle_background_and_handle_clicks\", function (d, index) {\n      d3.select(this).selectAll(\".circ_rect\").data([0]).join('rect').attr(\"class\", \"circ_rect\").attr(\"myindex\", index).attr('feature_name', d[0]).attr(\"width\", \"100%\").attr(\"height\", item_height - 18).attr(\"fill\", \"#f2f2f2\").attr(\"y\", 18).attr(\"x\", 0)\n        .on('click', () => {\n          if (self.props.clicked_features.includes(d[0])) {\n            self.props.Set_clicked_features(self.props.clicked_features.filter(item => item != d[0]))\n            d3.selectAll(\".\" + d[0]).selectAll(\".border_rect\").remove()\n          }\n          else {\n            self.props.Set_clicked_features([...self.props.clicked_features, d[0]])\n            d3.selectAll(\".\" + d[0]).selectAll(\".border_rect\").data([0]).join('rect').attr(\"class\", \"border_rect\").attr(\"width\", \"100%\").attr(\"height\", \"100%\").style(\"stroke\", \"black\").style(\"fill\", \"none\").style(\"stroke-width\", 5)\n          }\n        })\n    })\n    feature_containers.attr(\"CreatexpCircle\", function (d, index) {\n      var title_rect_height=16\n      CreatexpCircle(d, d3.select(this), selected_instances, self.props.lime_data, selected_year, [model_name], self.props.clicked_circles,\n        self.props.Set_clicked_circles, self.props.diverginColor, self.props.anim_config, item_width, item_height-(marginTop+marginBottom), self.props.deviation_array, index,self.props.threshold,self.props.dataset,title_rect_height,'label_on',sorted_features)\n    })\n    .attr(\"height\", function (d) {\n      if (d[1] == sorted_features.length - 1) {\n        var ft_svg_height = 25\n        var svg = d3.select(this.parentNode).selectAll(\".ft_svg\").data([0]).join(\"svg\").attr(\"x\", 0).attr(\"y\", parent_height - ft_svg_height).attr(\"class\", \"ft_svg\").attr(\"width\", item_width).attr(\"height\", ft_svg_height)\n        var markerBoxWidth = 8, markerBoxHeight = 8, refX = markerBoxWidth / 2, refY = markerBoxHeight / 2\n        svg.append('defs').append('marker').attr('id', 'arrow').attr('viewBox', [0, 0, markerBoxWidth, markerBoxHeight])\n          .attr('refX', refX).attr('refY', refY).attr('markerWidth', markerBoxWidth).attr('markerHeight', markerBoxHeight).attr('orient', 'auto-start-reverse')\n          .append('path').attr('d', d3.line()([[0, 0], [0, 7], [7, 3.8]])).attr('stroke', '#777777').attr(\"fill\",\"#777777\");\n        //------------------------------------------------[[x2, y2], [x1, y1]]\n        svg.append('path').attr('d', d3.line()([[item_width / 2 - 65, 15], [50, 15]])).attr('stroke', '#777777').attr('marker-end', 'url(#arrow)').attr('fill', 'none');\n        svg.append('path').attr('d', d3.line()([[item_width - 50, 15], [65 + item_width / 2, 15]])).attr('stroke', '#777777').attr('marker-start', 'url(#arrow)').attr('fill', 'none');\n\n        svg.selectAll(\".myText_low\").data([0]).join(\"text\").attr(\"x\", 30).attr(\"class\", \"myText_low\").attr('dominant-baseline', \"middle\").attr(\"y\", 15).text('Low').attr('text-anchor', 'middle').attr(\"font-size\", 12).attr(\"fill\", \"#2b2828\")\n        svg.selectAll(\".myText\").data([0]).join(\"text\").attr(\"x\", item_width / 2).attr(\"class\", \"myText\").attr('dominant-baseline', \"middle\").attr(\"y\", 15).text('attribute Importance').attr('text-anchor', 'middle').attr(\"font-size\", 12).attr(\"fill\", \"#2b2828\")\n        svg.selectAll(\".myText_high\").data([0]).join(\"text\").attr(\"x\", item_width-30).attr(\"class\", \"myText_high\").attr('dominant-baseline', \"middle\").attr(\"y\", 15).text('High').attr('text-anchor', 'middle').attr(\"font-size\", 12).attr(\"fill\", \"#2b2828\")\n        return item_height - marginBottom - marginTop\n      }\n      return item_height - marginBottom - marginTop\n    })\n    .attr('width', item_width)\n    feature_containers.attr('check_clicked_features', d => {\n      if (self.props.clicked_features.includes(d[0])) {\n        d3.selectAll(\".\" + d[0]).selectAll(\".border_rect\").data([0]).join('rect').attr(\"class\", \"border_rect\").attr(\"width\", \"100%\").attr(\"height\", \"100%\").style(\"stroke\", \"black\").style(\"fill\", \"none\").style(\"stroke-width\", 5)\n      }\n    })\n  }\n  //------------------------------\n  render() {\n    return (\n      <div className={\"explanation_chart_parent exp\" + this.props.model_name} style={{ width: '100%', height: '100%', \"border\": this.props.mode == 'Model' ? \"2px solid #e2e2e2\" : 'none', padding: \"2px 5px\" }}>\n        <p className=\"title_p\" style={{ padding: 0, margin: 0 }}>{this.props.model_name}</p>\n        <svg id={this.props.exp_id} style={{ marginTop: this.state.mds_height, width: \"100%\" }}></svg>\n        <marker id=\"arrow\" markerUnits=\"strokeWidth\" markerWidth=\"12\" markerHeight=\"12\" viewBox=\"0 0 12 12\" refX=\"6\" refY=\"6\" orient=\"auto\">\n          <path d=\"M2,2 L10,6 L2,10 L6,6 L2,2\" style={{ fill: \"black\" }}></path>\n        </marker>\n      </div>\n    )\n  }\n}\nconst maptstateToprop = (state) => {\n  return {\n    deviation_array: state.deviation_array,\n    original_data: state.original_data,\n    time_mode_model: state.time_mode_model,\n    chart_scale_type: state.chart_scale_type,\n    dataset: state.dataset,\n    histogram_data: state.histogram_data,\n    sparkline_data: state.sparkline_data,\n    anim_config: state.anim_config,\n    show: state.show,\n    average_m: state.average_m,\n    average_y: state.average_y,\n    lime_data: state.lime_data,\n    rank_data: state.rank_data,\n    clicked_circles: state.clicked_circles,\n    clicked_features: state.clicked_features,\n    threshold: state.threshold,\n    mode: state.mode,\n    dbclicked_features: state.dbclicked_features,\n    dragged_features: state.dragged_features,\n    url: state.url,\n  }\n}\nconst mapdispatchToprop = (dispatch) => {\n  return {\n    Set_dragged_features: (val) => dispatch({ type: \"dragged_features\", value: val }),\n    Set_clicked_circles: (val) => dispatch({ type: \"clicked_circles\", value: val }),\n    Set_prev_prop: (val) => dispatch({ type: \"prev_prop\", value: val }),\n    Set_sparkline_data: (val) => dispatch({ type: \"sparkline_data\", value: val }),\n    Set_replay: (val) => dispatch({ type: \"replay\", value: val }),\n    Set_clicked_features: (val) => dispatch({ type: \"clicked_features\", value: val }),\n    Set_selected_year: (val) => dispatch({ type: \"selected_year\", value: val }),\n    set_dbclicked_features: (val) => dispatch({ type: \"dbclicked_features\", value: val }),\n    Set_popup_chart_data: (val) => dispatch({ type: \"popup_chart_data\", value: val }),\n    set_pop_over: (val) => dispatch({ type: \"pop_over\", value: val }),\n    Set_deviation_array: (val) => dispatch({ type: \"deviation_array\", value: val }),\n  }\n}\nexport default connect(maptstateToprop, mapdispatchToprop)(SlopeChart);"]},"metadata":{},"sourceType":"module"}