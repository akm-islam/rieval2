{"ast":null,"code":"import _toConsumableArray from\"/Users/kaustav/NewWork/trivea/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import*as d3 from'd3';import*as $ from'jquery';import textures from'textures';export function Create_deviation_chart(parent_id,parent_exp_id,selected_instances,original_data,default_models,anim_config,selected_year,average,clicked_circles,Set_clicked_circles,diverginColor,sparkline_data,Set_selected_year,dataset,threshold){console.log(\"Test\",original_data[0],parent_id);var div=d3.select(\"body\").selectAll('.tooltip').data([0]).join(\"div\").attr(\"class\",\"tooltip\").style(\"opacity\",0);var parent_width=$(\"#\"+parent_id).width()-5;var parent_height=$(\".\"+'deviation_plot_container_div').height();// deviation_plot_container_div is the div that contains the deviation plot for all modes\nvar data=original_data.filter(function(item){return selected_year==item['1-qid']&&selected_instances.includes(parseInt(item['two_realRank']));});var temp_scale_data=[];data.map(function(item){default_models.map(function(model){return temp_scale_data.push(Math.abs(parseInt(item[model])-parseInt(item['two_realRank'])));});});// font_line_gap=sparkline_width+4\nvar config={space_for_state_name:120,fontSize:12,font_dy:-6,sparkline_width:0,font_line_gap:5,line_stroke_width:12,animation_duration:0,container_height:100,my_svg_top_margin:10,myg_top_margin:10};var y_distance=parent_height/selected_instances.length;if(y_distance<15){var y_distance=15;}//console.log(\"Checking\", y_distance, selected_instances)\nd3.select(\"#\"+parent_id).attr(\"height\",y_distance*selected_instances);var circle_radius=config.line_stroke_width/2;var t=textures.lines().size(5).strokeWidth(2).stroke(\"#cccccc\").background(\"gray\");var svg=d3.select(\"#\"+parent_id).attr('height',y_distance+data.length*y_distance).call(t);var parent_g=svg.selectAll(\".parent_g\").data([0]).join('g').attr('class','parent_g').attr('transform',\"translate(\"+0+\",13)\");var items_g=parent_g.selectAll(\".items\").data(data,function(d){return d['State'];}).join(function(enter){return enter.append(\"g\").attr(\"class\",\"items\").attr('transform',function(d,i){return\"translate(\"+config.space_for_state_name+\",\"+i*y_distance+\")\";});},function(update){return update.transition().duration(anim_config.rank_animation).attr('transform',function(d,i){return\"translate(\"+config.space_for_state_name+\",\"+i*y_distance+\")\";});},function(exit){return exit.remove();});items_g.attr(\"add_state\",function(d){d3.select(this).selectAll(\"text\").data([d]).join('text').text(function(dd){var max_textsize=15;var val=d['State'];if(val.length>max_textsize){val=val.replace(\"University\",\"U\");}if(val.length>max_textsize){val=val.substring(0,max_textsize)+\"..\";}return val+\" \"+d['two_realRank'];}).attr('fill',function(d){return diverginColor(d['two_realRank']);}).attr(\"dominant-baseline\",\"hanging\").attr(\"font-size\",config.fontSize).attr(\"x\",0).attr('text-anchor','end').attr(\"dy\",config.font_dy);}).attr(\"stroke\",function(d){if(clicked_circles.includes(d['id'])){return\"rgb(227, 26, 28,0.5)\";}})/*\n    .style(\"stroke-width\", (d) => {\n      if (clicked_circles.includes(d['id'])) {\n        return 2.5\n      }\n    })\n*/.attr(\"add_lines_and_circles\",function(d){var _this=this;var data_for_all_years=data.filter(function(item){return d['two_realRank']==parseInt(item['two_realRank']);});var line_data=[];default_models.map(function(model_name){data_for_all_years.map(function(item){var a={};var two_realRank=parseInt(item['two_realRank']);var predicted_rank=parseInt(item[model_name]);a['two_realRank']=two_realRank;a['predicted_rank']=predicted_rank;a[\"model\"]=model_name;a['year']=item['1-qid'];if(Math.abs(predicted_rank-two_realRank)<threshold){line_data.push(a);}});});// This is only for scaling starts here\nvar temp_scale_data=[];data.map(function(item){default_models.map(function(model){return temp_scale_data.push(Math.abs(parseInt(item[model])-parseInt(item['two_realRank'])));});});var temp_max=d3.max(temp_scale_data);var sclale1=d3.scaleLinear().domain([0,temp_max]).range([config.font_line_gap,parent_width-(config.space_for_state_name+circle_radius)]);if(temp_max==0){var sclale1=d3.scaleLinear().domain([0,temp_max]).range([config.font_line_gap,0]);}// This is only for scaling ends here\nd3.select(this).selectAll(\"line\").data([d]).join(function(enter){return enter.append('line').attr(\"x1\",config.font_line_gap).attr(\"y1\",function(d,i){return y_distance*i;}).attr(\"y2\",function(d,i){return y_distance*i;}).attr(\"stroke-width\",config.line_stroke_width).attr(\"stroke\",t.url()).attr(\"x2\",function(d2){var temp=[];line_data.map(function(item){return temp.push(Math.abs(item[\"predicted_rank\"]-item[\"two_realRank\"]));});return sclale1(d3.max(temp));});}// Update\n,function(update){return update.transition().duration(anim_config.deviation_animation).delay(anim_config.rank_animation).attr(\"x2\",function(d2){var temp=[];line_data.map(function(item){return temp.push(Math.abs(item[\"predicted_rank\"]-item[\"two_realRank\"]));});return sclale1(d3.max(temp));});});// ------------ Circles start here\nvar data_for_all_years=data.filter(function(item){return d['two_realRank']==parseInt(item['two_realRank']);});var circ_data=[];default_models.map(function(model_name){data_for_all_years.map(function(item){var a={};var two_realRank=parseInt(item['two_realRank']);var predicted_rank=parseInt(item[model_name]);a['two_realRank']=two_realRank;a['predicted_rank']=predicted_rank;a[\"model\"]=model_name;a['year']=item['1-qid'];//a['id'] = item['State'].replace(/ /g, '').replace(/[^a-zA-Z ]/g, \"\") + model_name.replace(/ /g, '').replace(/[^a-zA-Z ]/g, \"\")\na['id']=item['State'].replace(/ /g,'').replace(/[^a-zA-Z ]/g,\"\");a['className']=\"dev_circles \"+model_name.replace(/ /g,'').replace(/[^a-zA-Z ]/g,\"\");if(Math.abs(predicted_rank-two_realRank)<threshold){circ_data.push(a);}});});var my_circs=d3.select(this).selectAll(\".my_circles\").data(circ_data,function(d){return d['id'];}).join(function(enter){return enter.append(\"circle\").attr('id',function(d){return d['id'];}).attr(\"cx\",function(d2,i){d3.select(_this).classed(d2['id'],true);if(d2[\"predicted_rank\"]-d2['two_realRank']==0){return sclale1(Math.abs(d2[\"predicted_rank\"]-d2['two_realRank']))+circle_radius;}return sclale1(Math.abs(d2[\"predicted_rank\"]-d2['two_realRank']));});}// Update\n,function(update){return update.transition().duration(anim_config.deviation_animation).delay(anim_config.rank_animation).attr(\"cx\",function(d2,i){d3.select(_this).classed(d2['id'],true);if(d2[\"predicted_rank\"]-d2['two_realRank']==0){return sclale1(Math.abs(d2[\"predicted_rank\"]-d2['two_realRank']))+circle_radius;}return sclale1(Math.abs(d2[\"predicted_rank\"]-d2['two_realRank']));});});my_circs.attr(\"r\",circle_radius).attr('class',function(d){return'my_circles '+d['className'];}).attr('fill',function(d){return diverginColor(d['two_realRank']);}).attr(\"parent_id\",parent_exp_id).on('click',function(d){return Set_clicked_circles(clicked_circles.includes(d['id'])?clicked_circles.filter(function(item){return item!=d['id'];}):[].concat(_toConsumableArray(clicked_circles),[d['id']]));}).on(\"mouseover\",function(d2){div.transition().duration(200).style(\"opacity\",.9);div.html(\"Year : \"+d2[\"year\"]+\"<br></br>\"+\"Model: \"+d2[\"model\"]+\"<br></br>\"+\"Deviation: \"+Math.abs(d2[\"predicted_rank\"]-d2['two_realRank'])).style(\"left\",d3.event.pageX-140+\"px\").style(\"top\",d3.event.pageY-98+\"px\");}).on(\"mouseout\",function(d2){//d3.select(this).classed(d2['id'],true)\ndiv.transition().duration(500).style(\"opacity\",0);});});}","map":{"version":3,"sources":["/Users/kaustav/NewWork/trivea/src/components/Charts/DevPlot/deviation_chart.js"],"names":["d3","$","textures","Create_deviation_chart","parent_id","parent_exp_id","selected_instances","original_data","default_models","anim_config","selected_year","average","clicked_circles","Set_clicked_circles","diverginColor","sparkline_data","Set_selected_year","dataset","threshold","console","log","div","select","selectAll","data","join","attr","style","parent_width","width","parent_height","height","filter","item","includes","parseInt","temp_scale_data","map","model","push","Math","abs","config","space_for_state_name","fontSize","font_dy","sparkline_width","font_line_gap","line_stroke_width","animation_duration","container_height","my_svg_top_margin","myg_top_margin","y_distance","length","circle_radius","t","lines","size","strokeWidth","stroke","background","svg","call","parent_g","items_g","d","enter","append","i","update","transition","duration","rank_animation","exit","remove","text","dd","max_textsize","val","replace","substring","data_for_all_years","line_data","model_name","a","two_realRank","predicted_rank","temp_max","max","sclale1","scaleLinear","domain","range","url","d2","temp","deviation_animation","delay","circ_data","my_circs","classed","on","html","event","pageX","pageY"],"mappings":"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","sourcesContent":["import * as d3 from 'd3';\nimport * as $ from 'jquery';\nimport textures from 'textures';\n\nexport function Create_deviation_chart(parent_id, parent_exp_id, selected_instances, original_data, default_models, anim_config, selected_year, average, clicked_circles, Set_clicked_circles, diverginColor, sparkline_data, Set_selected_year, dataset, threshold) {\n  console.log(\"Test\",original_data[0], parent_id)\n  var div = d3.select(\"body\").selectAll('.tooltip').data([0]).join(\"div\").attr(\"class\", \"tooltip\").style(\"opacity\", 0);\n  var parent_width = $(\"#\" + parent_id).width() - 5\n  var parent_height = $(\".\" + 'deviation_plot_container_div').height() // deviation_plot_container_div is the div that contains the deviation plot for all modes\n  var data = original_data.filter(item => selected_year == item['1-qid'] && selected_instances.includes(parseInt(item['two_realRank'])))\n  var temp_scale_data = []\n  data.map(item => { default_models.map(model => temp_scale_data.push(Math.abs(parseInt(item[model]) - parseInt(item['two_realRank'])))) })\n\n  // font_line_gap=sparkline_width+4\n  var config = { space_for_state_name: 120, fontSize: 12, font_dy: -6, sparkline_width: 0, font_line_gap: 5, line_stroke_width: 12, animation_duration: 0, container_height: 100, my_svg_top_margin: 10, myg_top_margin: 10 }\n  var y_distance = parent_height / selected_instances.length\n  if (y_distance < 15) { var y_distance = 15 }\n  //console.log(\"Checking\", y_distance, selected_instances)\n  d3.select(\"#\" + parent_id).attr(\"height\", y_distance * selected_instances)\n\n  var circle_radius = config.line_stroke_width / 2\n  var t = textures.lines().size(5).strokeWidth(2).stroke(\"#cccccc\").background(\"gray\");\n  var svg = d3.select(\"#\" + parent_id).attr('height', y_distance + data.length * y_distance).call(t)\n  var parent_g = svg.selectAll(\".parent_g\").data([0]).join('g').attr('class', 'parent_g').attr('transform', \"translate(\" + 0 + \",13)\")\n  var items_g = parent_g.selectAll(\".items\").data(data, d => d['State']).join(enter => enter.append(\"g\").attr(\"class\", \"items\")\n    .attr('transform', (d, i) => \"translate(\" + config.space_for_state_name + \",\" + i * y_distance + \")\")\n    , update => update.transition().duration(anim_config.rank_animation).attr('transform', (d, i) => \"translate(\" + config.space_for_state_name + \",\" + i * y_distance + \")\")\n    , exit => exit.remove()\n  )\n  items_g.attr(\"add_state\", function (d) {\n    d3.select(this).selectAll(\"text\").data([d]).join('text')\n      .text(dd => {\n        var max_textsize = 15\n        var val = d['State']\n        if (val.length > max_textsize) { val = val.replace(\"University\", \"U\") }\n        if (val.length > max_textsize) { val = val.substring(0, max_textsize) + \"..\" }\n        return val + \" \" + d['two_realRank']\n      })\n      .attr('fill', d => diverginColor(d['two_realRank'])).attr(\"dominant-baseline\", \"hanging\").attr(\"font-size\", config.fontSize)\n      .attr(\"x\", 0).attr('text-anchor', 'end').attr(\"dy\", config.font_dy)\n  }).attr(\"stroke\", (d) => {\n    if (clicked_circles.includes(d['id'])) {\n      return \"rgb(227, 26, 28,0.5)\"\n    }\n  })\n  /*\n    .style(\"stroke-width\", (d) => {\n      if (clicked_circles.includes(d['id'])) {\n        return 2.5\n      }\n    })\n*/\n    .attr(\"add_lines_and_circles\", function (d) {\n      var data_for_all_years = data.filter(item => d['two_realRank'] == parseInt(item['two_realRank']))\n      var line_data = []\n      default_models.map(model_name => {\n        data_for_all_years.map(item => {\n          var a = {}\n          var two_realRank = parseInt(item['two_realRank'])\n          var predicted_rank = parseInt(item[model_name])\n          a['two_realRank'] = two_realRank\n          a['predicted_rank'] = predicted_rank\n          a[\"model\"] = model_name\n          a['year'] = item['1-qid']\n          if (Math.abs(predicted_rank - two_realRank) < threshold) {\n            line_data.push(a)\n          }\n        })\n      })\n      // This is only for scaling starts here\n      var temp_scale_data = []\n      data.map(item => { default_models.map(model => temp_scale_data.push(Math.abs(parseInt(item[model]) - parseInt(item['two_realRank'])))) })\n      var temp_max = d3.max(temp_scale_data)\n      var sclale1 = d3.scaleLinear().domain([0, temp_max]).range([config.font_line_gap, parent_width - (config.space_for_state_name + circle_radius)])\n      if (temp_max == 0) { var sclale1 = d3.scaleLinear().domain([0, temp_max]).range([config.font_line_gap, 0]) }\n      // This is only for scaling ends here\n      d3.select(this).selectAll(\"line\").data([d]).join(enter => enter.append('line')\n        .attr(\"x1\", config.font_line_gap).attr(\"y1\", (d, i) => y_distance * i).attr(\"y2\", (d, i) => y_distance * i).attr(\"stroke-width\", config.line_stroke_width).attr(\"stroke\", t.url()).attr(\"x2\", (d2) => {\n          var temp = []\n          line_data.map(item => temp.push(Math.abs(item[\"predicted_rank\"] - item[\"two_realRank\"])))\n          return sclale1(d3.max(temp))\n        })\n        // Update\n        , update => update.transition().duration(anim_config.deviation_animation).delay(anim_config.rank_animation).attr(\"x2\", (d2) => {\n          var temp = []\n          line_data.map(item => temp.push(Math.abs(item[\"predicted_rank\"] - item[\"two_realRank\"])))\n          return sclale1(d3.max(temp))\n        }))\n      // ------------ Circles start here\n      var data_for_all_years = data.filter(item => d['two_realRank'] == parseInt(item['two_realRank']))\n      var circ_data = []\n      default_models.map(model_name => {\n        data_for_all_years.map(item => {\n          var a = {}\n          var two_realRank = parseInt(item['two_realRank'])\n          var predicted_rank = parseInt(item[model_name])\n          a['two_realRank'] = two_realRank\n          a['predicted_rank'] = predicted_rank\n          a[\"model\"] = model_name\n          a['year'] = item['1-qid']\n          //a['id'] = item['State'].replace(/ /g, '').replace(/[^a-zA-Z ]/g, \"\") + model_name.replace(/ /g, '').replace(/[^a-zA-Z ]/g, \"\")\n          a['id'] = item['State'].replace(/ /g, '').replace(/[^a-zA-Z ]/g, \"\")\n          a['className'] = \"dev_circles \" + model_name.replace(/ /g, '').replace(/[^a-zA-Z ]/g, \"\")\n          if (Math.abs(predicted_rank - two_realRank) < threshold) {\n            circ_data.push(a)\n          }\n        })\n      })\n      var my_circs = d3.select(this).selectAll(\".my_circles\").data(circ_data, d => d['id']).join(\n        enter => enter.append(\"circle\").attr('id', d => d['id']).attr(\"cx\", (d2, i) => {\n          d3.select(this).classed(d2['id'], true)\n          if (d2[\"predicted_rank\"] - d2['two_realRank'] == 0) { return sclale1(Math.abs(d2[\"predicted_rank\"] - d2['two_realRank'])) + circle_radius }\n          return sclale1(Math.abs(d2[\"predicted_rank\"] - d2['two_realRank']))\n        })\n        // Update\n        , update => update.transition().duration(anim_config.deviation_animation).delay(anim_config.rank_animation).attr(\"cx\", (d2, i) => {\n          d3.select(this).classed(d2['id'], true)\n          if (d2[\"predicted_rank\"] - d2['two_realRank'] == 0) { return sclale1(Math.abs(d2[\"predicted_rank\"] - d2['two_realRank'])) + circle_radius }\n          return sclale1(Math.abs(d2[\"predicted_rank\"] - d2['two_realRank']))\n        })\n      )\n      my_circs.attr(\"r\", circle_radius).attr('class', d => 'my_circles ' + d['className'])\n        .attr('fill', d => diverginColor(d['two_realRank'])).attr(\"parent_id\", parent_exp_id)\n        .on('click', d => Set_clicked_circles(clicked_circles.includes(d['id']) ? clicked_circles.filter(item => item != d['id']) : [...clicked_circles, d['id']]))\n        .on(\"mouseover\", function (d2) {\n          div.transition().duration(200).style(\"opacity\", .9);\n          div.html(\"Year : \" + d2[\"year\"] + \"<br></br>\" + \"Model: \" + d2[\"model\"] + \"<br></br>\" + \"Deviation: \" + Math.abs(d2[\"predicted_rank\"] - d2['two_realRank']))\n            .style(\"left\", (d3.event.pageX - 140) + \"px\").style(\"top\", (d3.event.pageY - 98) + \"px\");\n        }).on(\"mouseout\", function (d2) {\n          //d3.select(this).classed(d2['id'],true)\n          div.transition()\n            .duration(500)\n            .style(\"opacity\", 0);\n        })\n\n    })\n\n}"]},"metadata":{},"sourceType":"module"}