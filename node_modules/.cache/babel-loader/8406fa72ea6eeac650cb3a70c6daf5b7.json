{"ast":null,"code":"import * as d3 from 'd3';\n\nvar CreateCatChart = (data, feature, scatterplot_data, props) => {\n  var rScale = d3.scalePow().exponent(0.4).domain(d3.extent(props.deviation_array)).range([6, 1]);\n  var feature_contribute = feature + \"_contribution\";\n  var margin = {\n    top: 0,\n    right: 30,\n    bottom: 85,\n    left: 50,\n    space_for_hist: 0\n  },\n      feature_width = 520 - margin.left - margin.right,\n      height = 270 - margin.top - margin.bottom;\n  var barplot_data = {};\n  data = data.filter(d => parseFloat(d[feature_contribute]) > 0);\n  data.map(item => {\n    if (barplot_data[item[feature]] > 0) {\n      barplot_data[item[feature]] += 1;\n    } else {\n      barplot_data[item[feature]] = 1;\n    }\n  });\n  var temp_y = Object.keys(barplot_data),\n      temp_x = Object.values(barplot_data),\n      x = d3.scaleLinear().domain([d3.min(temp_x), d3.max(temp_x)]).range([0, feature_width]).nice(); // circles will start from y position 10 and go upto height-10\n\n  var y = d3.scaleBand().domain(temp_y).range([0, height]).padding(0.1); // add the x Axis\n  //------------------------------------------------------------- All svgs\n\n  var parent_svg = d3.select(\"#\" + props.myid).attr(\"width\", feature_width + margin.left + margin.right).attr(\"height\", height + margin.top + margin.bottom + margin.space_for_hist),\n      svg1 = parent_svg.selectAll('.svg11').data([0]).join('svg').attr(\"y\", margin.space_for_hist).attr(\"class\", \"svg11\").selectAll(\".myg\").data([0]).join('g').attr(\"class\", \"myg\").attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n  var svg1 = parent_svg.selectAll('.svg11').data([0]).join('svg').attr(\"class\", \"svg11\").selectAll(\".myg\").data([0]).join('g').attr(\"class\", \"myg\").attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\"); //------------- Add Y axis\n\n  svg1.selectAll(\".myYaxis\").data([0]).join('g').attr(\"class\", \"myYaxis\").attr(\"transform\", \"translate(\" + (feature_width + 20) + \",20)\").call(d3.axisLeft(y).tickSize(feature_width)).selectAll(\"text\").selectAll(\".tick line\").remove();\n  svg1.selectAll(\".domain\").remove();\n  svg1.selectAll(\".tick line\").attr(\"stroke\", \"#EBEBEB\"); //------------------------------------------------------------------------------------------------------ Scatterplot starts here\n\n  svg1.selectAll(\".scatterplot_g\").data(scatterplot_data).join('g').attr(\"id\", d => d[0] + \"scatterplot_g_id\").attr(\"class\", \"scatterplot_g\").attr(\"ax\", function (d) {\n    var temp_x = d[1].map(item => parseFloat(item[feature + \"_contribution\"])); // d[1] \n\n    x = d3.scaleLinear().domain([d3.min(temp_x), d3.max(temp_x)]).range([0, feature_width]).nice();\n    var circle_data = d[1].sort((a, b) => a['deviation'] - b['deviation']);\n    d3.select(this).selectAll('circle').data(circle_data).join(\"circle\").attr(\"cy\", (d, i) => {\n      return y(d[feature]) + 35;\n    }).attr(\"cx\", (d, i) => {\n      return x(parseFloat(d[feature_contribute]));\n    }).attr(\"r\", d => parseFloat(d[feature_contribute]) <= 0 ? 0 : rScale(d['deviation'])).attr(\"fill\", d => {\n      return props.diverginColor(d['two_realRank']).replace(\")\", \",.7)\");\n    }).attr('class', d => 'my_circles').attr(\"id\", d => d['id']).on('click', d => {\n      props.Set_clicked_circles(props.clicked_circles.includes(d['id']) ? props.clicked_circles.filter(item => item != d['id']) : [...props.clicked_circles, d['id']]);\n    });\n  }); //---------------------------------------------Feature Importance with Arrow\n\n  var ft_svg_height = 25;\n  parent_svg.selectAll(\".ft_svg\").remove();\n  var ft_svg = parent_svg.selectAll(\".ft_svg\").data([Math.random()]).join(\"svg\").attr(\"x\", 70).attr(\"y\", height + 10).attr(\"class\", \"ft_svg\").attr(\"width\", feature_width).attr(\"height\", ft_svg_height);\n  var markerBoxWidth = 8,\n      markerBoxHeight = 8,\n      refX = markerBoxWidth / 2,\n      refY = markerBoxHeight / 2;\n  ft_svg.selectAll('defs').data([0]).join('defs').selectAll('#arrow').data([0]).join('marker').attr('id', 'arrow').attr('viewBox', [0, 0, markerBoxWidth, markerBoxHeight]).attr('refX', refX).attr('refY', refY).attr('markerWidth', markerBoxWidth).attr('markerHeight', markerBoxHeight).attr('orient', 'auto-start-reverse').append('path').attr('id', 'path1').attr('d', d3.line()([[0, 0], [0, 7], [7, 3.8]])).attr('stroke', '#777777').attr(\"fill\", \"#777777\"); //------------------------------------------------[[x2, y2], [x1, y1]]\n\n  ft_svg.append('path').attr('d', d3.line()([[feature_width / 2 - 65, 15], [50, 15]])).attr('stroke', '#777777').attr('marker-end', 'url(#arrow)').attr('fill', 'none');\n  ft_svg.append('path').attr('d', d3.line()([[feature_width - 50, 15], [65 + feature_width / 2, 15]])).attr('stroke', '#777777').attr('marker-start', 'url(#arrow)').attr('fill', 'none');\n  ft_svg.selectAll(\".myText_low\").data([0]).join(\"text\").attr(\"x\", 30).attr(\"class\", \"myText_low\").attr('dominant-baseline', \"middle\").attr(\"y\", 15).text('Low').attr('text-anchor', 'middle').attr(\"font-size\", 12).attr(\"fill\", \"#2b2828\");\n  ft_svg.selectAll(\".myText\").data([0]).join(\"text\").attr(\"x\", feature_width / 2).attr(\"class\", \"myText\").attr('dominant-baseline', \"middle\").attr(\"y\", 15).text('Attribute Importance').attr('text-anchor', 'middle').attr(\"font-size\", 12).attr(\"fill\", \"#2b2828\");\n  ft_svg.selectAll(\".myText_high\").data([0]).join(\"text\").attr(\"x\", feature_width - 30).attr(\"class\", \"myText_high\").attr('dominant-baseline', \"middle\").attr(\"y\", 15).text('High').attr('text-anchor', 'middle').attr(\"font-size\", 12).attr(\"fill\", \"#2b2828\"); //---------------------------------------------Feature Importance with Arrow\n  // Define the div for the tooltip\n\n  var div = d3.select(\"body\").append(\"div\").attr(\"class\", \"tooltip2\").style(\"opacity\", 0);\n  d3.selectAll('.exp_circles').on(\"mouseover\", function (d) {\n    div.transition().duration(200).style(\"opacity\", .9);\n    div.html(\"<p>\" + d['State'] + \"</p>\" + \"<p>\" + \"Model: \" + d3.select(this).attr('dataset_name') + \"</p>\") //div.html(d['State'])\n    .style(\"left\", d3.event.pageX + \"px\").style(\"top\", d3.event.pageY - 28 + \"px\");\n  }).on(\"mouseout\", function (d) {\n    d3.selectAll('.tooltip2').transition().duration(500).style(\"opacity\", 0);\n  }); //------------------------------------------------------------------------------------------------------ Scatterplot ends here\n};\n\nexport default CreateCatChart;","map":{"version":3,"sources":["/Users/kaustav/NewWork/trivea/src/components/Charts/Popover/CreateCatChart.js"],"names":["d3","CreateCatChart","data","feature","scatterplot_data","props","rScale","scalePow","exponent","domain","extent","deviation_array","range","feature_contribute","margin","top","right","bottom","left","space_for_hist","feature_width","height","barplot_data","filter","d","parseFloat","map","item","temp_y","Object","keys","temp_x","values","x","scaleLinear","min","max","nice","y","scaleBand","padding","parent_svg","select","myid","attr","svg1","selectAll","join","call","axisLeft","tickSize","remove","circle_data","sort","a","b","i","diverginColor","replace","on","Set_clicked_circles","clicked_circles","includes","ft_svg_height","ft_svg","Math","random","markerBoxWidth","markerBoxHeight","refX","refY","append","line","text","div","style","transition","duration","html","event","pageX","pageY"],"mappings":"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","sourcesContent":["import * as d3 from 'd3';\nvar CreateCatChart = (data, feature, scatterplot_data,props) => {\n    var rScale = d3.scalePow().exponent(0.4).domain(d3.extent(props.deviation_array)).range([6, 1])\n    var feature_contribute = feature + \"_contribution\"\n    var margin = { top: 0, right: 30, bottom: 85, left: 50, space_for_hist: 0 }, feature_width = 520 - margin.left - margin.right, height = 270 - margin.top - margin.bottom;\n    var barplot_data = {}\n    data = data.filter(d => parseFloat(d[feature_contribute]) > 0)\n    data.map(item => { if (barplot_data[item[feature]] > 0) { barplot_data[item[feature]] += 1 } else { barplot_data[item[feature]] = 1 } })\n\n    var temp_y = Object.keys(barplot_data),\n        temp_x = Object.values(barplot_data),\n        x = d3.scaleLinear().domain([d3.min(temp_x), d3.max(temp_x)]).range([0, feature_width]).nice(); // circles will start from y position 10 and go upto height-10\n\n    var y = d3.scaleBand().domain(temp_y).range([0, height]).padding(0.1);\n\n    // add the x Axis\n    //------------------------------------------------------------- All svgs\n    var parent_svg = d3.select(\"#\" + props.myid).attr(\"width\", feature_width + margin.left + margin.right).attr(\"height\", height + margin.top + margin.bottom + margin.space_for_hist),\n        svg1 = parent_svg.selectAll('.svg11').data([0]).join('svg').attr(\"y\", margin.space_for_hist).attr(\"class\", \"svg11\").selectAll(\".myg\").data([0]).join('g').attr(\"class\", \"myg\").attr(\"transform\",\"translate(\" + margin.left + \",\" + margin.top + \")\")\n    var svg1 = parent_svg.selectAll('.svg11').data([0]).join('svg').attr(\"class\", \"svg11\").selectAll(\".myg\").data([0]).join('g').attr(\"class\", \"myg\").attr(\"transform\",\"translate(\" + margin.left + \",\" + margin.top + \")\")   \n    //------------- Add Y axis\n    svg1.selectAll(\".myYaxis\").data([0]).join('g').attr(\"class\", \"myYaxis\").attr(\"transform\", \"translate(\"+(feature_width+20)+\",20)\").call(d3.axisLeft(y).tickSize(feature_width)).selectAll(\"text\").selectAll(\".tick line\").remove()        \n    svg1.selectAll(\".domain\").remove()\n    svg1.selectAll(\".tick line\").attr(\"stroke\", \"#EBEBEB\")\n    //------------------------------------------------------------------------------------------------------ Scatterplot starts here\n    svg1.selectAll(\".scatterplot_g\").data(scatterplot_data).join('g').attr(\"id\", d => d[0] + \"scatterplot_g_id\").attr(\"class\", \"scatterplot_g\").attr(\"ax\", function (d) {\n        var temp_x = d[1].map(item => parseFloat(item[feature + \"_contribution\"])) // d[1] \n        x = d3.scaleLinear().domain([d3.min(temp_x), d3.max(temp_x)]).range([0, feature_width]).nice();\n        var circle_data=d[1].sort((a,b)=>a['deviation']-b['deviation'])\n        d3.select(this).selectAll('circle').data(circle_data)\n            .join(\"circle\")\n            .attr(\"cy\", (d, i) => {\n                return y(d[feature])+35\n            })\n            .attr(\"cx\", (d, i) => {\n                return x(parseFloat(d[feature_contribute]))\n\n            })\n            \n            .attr(\"r\", d => parseFloat(d[feature_contribute]) <= 0 ? 0 : rScale(d['deviation']))\n            .attr(\"fill\", (d) => {\n                return props.diverginColor(d['two_realRank']).replace(\")\",\",.7)\")\n            })\n\n            .attr('class', d => 'my_circles')\n            .attr(\"id\", d => d['id'])\n            .on('click', d => {\n                props.Set_clicked_circles(props.clicked_circles.includes(d['id']) ? props.clicked_circles.filter(item => item != d['id']) : [...props.clicked_circles, d['id']])\n            })\n    })\n  //---------------------------------------------Feature Importance with Arrow\n  var ft_svg_height = 25\n  parent_svg.selectAll(\".ft_svg\").remove()\n  var ft_svg = parent_svg.selectAll(\".ft_svg\").data([Math.random()]).join(\"svg\").attr(\"x\", 70).attr(\"y\", height+10).attr(\"class\", \"ft_svg\").attr(\"width\", feature_width).attr(\"height\", ft_svg_height)\n  var markerBoxWidth = 8, markerBoxHeight = 8, refX = markerBoxWidth / 2, refY = markerBoxHeight / 2\n  \n  ft_svg.selectAll('defs').data([0]).join('defs').selectAll('#arrow').data([0]).join('marker').attr('id', 'arrow').attr('viewBox', [0, 0, markerBoxWidth, markerBoxHeight])\n    .attr('refX', refX).attr('refY', refY).attr('markerWidth', markerBoxWidth).attr('markerHeight', markerBoxHeight).attr('orient', 'auto-start-reverse')\n    .append('path').attr('id','path1').attr('d', d3.line()([[0, 0], [0, 7], [7, 3.8]])).attr('stroke', '#777777').attr(\"fill\",\"#777777\");\n  //------------------------------------------------[[x2, y2], [x1, y1]]\n  ft_svg.append('path').attr('d', d3.line()([[feature_width / 2 - 65, 15], [50, 15]])).attr('stroke', '#777777').attr('marker-end', 'url(#arrow)').attr('fill', 'none');\n  ft_svg.append('path').attr('d', d3.line()([[feature_width - 50, 15], [65 + feature_width / 2, 15]])).attr('stroke', '#777777').attr('marker-start', 'url(#arrow)').attr('fill', 'none');\n\n  ft_svg.selectAll(\".myText_low\").data([0]).join(\"text\").attr(\"x\", 30).attr(\"class\", \"myText_low\").attr('dominant-baseline', \"middle\").attr(\"y\", 15).text('Low').attr('text-anchor', 'middle').attr(\"font-size\", 12).attr(\"fill\", \"#2b2828\")\n  ft_svg.selectAll(\".myText\").data([0]).join(\"text\").attr(\"x\", feature_width / 2).attr(\"class\", \"myText\").attr('dominant-baseline', \"middle\").attr(\"y\", 15).text('Attribute Importance').attr('text-anchor', 'middle').attr(\"font-size\", 12).attr(\"fill\", \"#2b2828\")\n  ft_svg.selectAll(\".myText_high\").data([0]).join(\"text\").attr(\"x\", feature_width-30).attr(\"class\", \"myText_high\").attr('dominant-baseline', \"middle\").attr(\"y\", 15).text('High').attr('text-anchor', 'middle').attr(\"font-size\", 12).attr(\"fill\", \"#2b2828\")\n  //---------------------------------------------Feature Importance with Arrow\n\n\n\n    // Define the div for the tooltip\n    var div = d3.select(\"body\").append(\"div\")\n        .attr(\"class\", \"tooltip2\")\n        .style(\"opacity\", 0);\n    d3.selectAll('.exp_circles')\n        .on(\"mouseover\", function (d) {\n            div.transition()\n                .duration(200)\n                .style(\"opacity\", .9);\n            div.html(\"<p>\" + d['State'] + \"</p>\" + \"<p>\" + \"Model: \" + d3.select(this).attr('dataset_name') + \"</p>\")\n                //div.html(d['State'])\n                .style(\"left\", (d3.event.pageX) + \"px\")\n                .style(\"top\", (d3.event.pageY - 28) + \"px\");\n        })\n        .on(\"mouseout\", function (d) {\n            d3.selectAll('.tooltip2').transition()\n                .duration(500)\n                .style(\"opacity\", 0);\n        })\n\n    //------------------------------------------------------------------------------------------------------ Scatterplot ends here\n}\nexport default CreateCatChart"]},"metadata":{},"sourceType":"module"}